---
title: "Draft-assinment1"
author: "Kun Shen, Xiang Li, Xue Zhou"
date: "February 10, 2017"
output: html_document
---

```{r setup, include=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Introduction
# 2. Objective
# 3. Dataset Preparation
Our analysis focuses on the data of year 2012 -2013 of 23 variables. We chose the median income 6 years after graduation as our predictor variable, and eliminated many fields with bunch of missing values as well as some fields not pertainig enougn to post-graduation income. We then fosued primarily on a set of 23 variables, including gender, age, ethnic, acedemic costs, family income, completetion rates and replayment rate.  


The following libraries have been used in the analysis: 
```{r, message=FALSE,warning=FALSE}

library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)

```


We loaded ScoreCard from the US Dapartment of Education. The main dataset spans nearly 20 years of data and covering multiple sources including IPEDS, NSLDS, and Department of Treasury. To ensure the maximum data accurary and availablity, we choose the subset of year 2012 - 2013 as our analysis sample. 
```{r, message=FALSE,warning=FALSE}

data = read.csv("MERGED2012_13_PP.csv",header = T, na.strings = "NULL")

```

The full dataset contains 1743 variables. 36 variables were intially selected to analyze.
```{r, message=FALSE,warning=FALSE}

variable = select(data, STABBR, PREDDEG, LOCALE2, MENONLY, WOMENONLY, CONTROL, ADM_RATE, SATMTMID, SATVRMID, SATWRMID, SAT_AVG,
                  NPT4_PUB,
                  NPT4_PRIV,
                  UG,
                  UG_NRA,
                  UG_UNKN,
                  UG_WHITENH,
                  UG_BLACKNH,
                  UG_API,
                  UG_AIANOLD,
                  UG_HISPOLD,
                  DEP_STAT_PCT_IND,
                  PAR_ED_PCT_1STGEN,
                  MD_FAMINC,
                  MEDIAN_HH_INC,
                  POVERTY_RATE,
                  PCTPELL,
                  PCTFLOAN,
                  GRAD_DEBT_MDN,
                  WDRAW_DEBT_MDN,
                  APPL_SCH_PCT_GE5,
                  C150_4,
                  MD_EARN_WNE_P6,
                  MN_EARN_WNE_P10,
                  RPY_3YR_RT_SUPP,
                  CDR3)


```






After loading the dataset, we change variables to the correct data types. 
```{r, message=FALSE,warning=FALSE}

class(as.data.frame(apply(variable[,-c(1,2,6)],2,as.numeric)))

#numeric
variable[,-c(1,2,6)] %>%
    apply(2, as.numeric) %>%
    as.data.frame() %>%
    {.} -> variable_num

#categorical
variable$preF=factor(variable$PREDDEG,levels=c(0,1,2,3,4),labels = c("NotClassified","Certificate-degree","Associate's-degree","Bachelor's-degree","Graduate-degree"))
variable$ctrF=factor(variable$CONTROL,levels = c(1,2,3),labels = c("Public","Private Nonprofit","Private For-profit"))

#combine the three datafram to generate a new dataset. 
data_new <- cbind(variable_num,variable$preF, variable$ctrF,variable$STABBR)
dim(data_new)

mean(is.na(data_new$NPT4_PUB))
```




```{r, message=FALSE,warning=FALSE}

for (i in 1:length(data_new$NPT4_PRIV)) {
   if (is.na(data_new$NPT4_PRIV[i])) {
       data_new$NPT4_PRIV[i] = data_new$NPT4_PUB[i]
   }
}
mean(is.na(data_new$NPT4_PRIV))
data_new = data_new[,-9]
colnames(data_new)[9] <- "NPT4_COMBINE"
```

In order to choose the variables that have enough valid data related to the topic, we filtered and considered variables with percent missing value less than 25%. The new data set was named as “data_clean” for further analysis. 
```{r, message=FALSE,warning=FALSE}

data_clean = data_new[,colMeans(is.na(data_new)) < 0.25]
write.csv(data_clean,"data_clean.csv")
```

#Variable summary
For numeric variabls, we calculate the basic summary statistics such as median, min, max, mode and quantile. We also use visualizations such as hisgroms and boxplots to understand the distribution of the values. For categorical variables, we use frequency table to understand the frequcies of each categories.Box chart is used as a visualization tool.

The table below lists the variables that will be used for the further analysis: 12 of them are continuous variables while 3 of them are categorical variables. Our data set now contains 120 rows and 15 columns. 120 rows consist of 20 years’ of data for each of the chosen six countries. The 15 columns consist of country name, country code, year, and the twelve indicators.

| Variable Name    | Data Type         | Categorical or Continuous         | hi       |
| --------------  | ----------------- | --------------------------------- | -------- |
| NPT4_COMBINE    | Numeric           |  Continuous                       |  Cost    |
| DEP_STAT_PCT_IND | Numeric           |  Continuous                       |     n    |
| PAR_ED_PCT_1STGEN| Numeric           |  Continuous                       |      n   |
| MD_FAMINC        | Numeric           |  Continuous                       |       n  |
| PCTPELL          | Numeric           |  Continuous                       |n         |
| PCTFLOAN         | Numeric           |  Continuous                       | n        |
| GRAD_DEBT_MDN    | Numeric           |  Continuous                       |  nn      |
| WDRAW_DEBT_MDN   | Numeric           |  Continuous                       |    n     |
| MD_EARN_WNE_P6   | Numeric           |  Continuous                       |     n    |
| MN_EARN_WNE_P10  | Numeric           |  Continuous                       |       n  |
| RPY_3YR_RT_SUPP  | Numeric           |  Continuous                       |      n   |
| CDR3             | Numeric           |  Continuous                       | n        |
| variable$qreF    | Factor            |  Categorical                      |  n       |
| variable$ctrF    | Factor            |  Categorical                      |   n      |
| variable$STABBR  | Factor            |  Categorical                      |   n      |

we will summarize the data set using dplyr functions in the variables summary section.

#4 Goals
#5 Summary of variables
##5.1 Individual variable summary

###5.1.1 Average net price for Title IV institutions(both public and private institutions)
We are using the code below to summarize the continuous data

```{R, message=FALSE, warinig = FALSE}


summarize(group_by(data_clean, variable$STABBR),
          minNPT4_COMBINE=min(NPT4_COMBINE ,na.rm=TRUE),
          maxNPT4_COMBINE=max(NPT4_COMBINE,na.rm=TRUE),
          meanNPT4_COMBINE=mean(NPT4_COMBINE,na.rm=TRUE),
          medianNPT4_COMBINE=median(NPT4_COMBINE,na.rm=TRUE),
          sdNPT4_COMBINE = sd(NPT4_COMBINE,na.rm=TRUE))

data_clean %>%
  group_by(variable$STABBR) %>%
    summarise(minNPT4_COMBINE=min(NPT4_COMBINE ,na.rm=TRUE),    maxNPT4_COMBINE=max(NPT4_COMBINE,na.rm=TRUE),medianNPT4_COMBINE=median(NPT4_COMBINE,na.rm=TRUE))  %>%
    arrange(medianNPT4_COMBINE)   %>%
{.}  ->test

test

#Here is the quartile statistics :
summary(data_clean$NPT4_COMBINE,na.rm=TRUE)
quantile(data_clean$NPT4_COMBINE,na.rm=TRUE)




  #histogram for NPT_COM
  ggplot(data=data_clean , aes(NPT4_COMBINE)) + 
    geom_histogram(breaks=seq(0, 90000, by =2000), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for NPT_COM") +
    labs(x="NPT_COM", y="Count")
```




##5.2 Relationship between variables
##5.3 Comparison between variables

#6. Findings and Conclusion
    




