---
title: "Draft-assinment1"
author: "Kun Shen, Xiang Li, Xue Zhou"
date: "February 10, 2017"
output: html_document
---

<<<<<<< HEAD
```{r setup, include=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
=======
```{r setup, include=FALSE,warning=FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE)
>>>>>>> 344d8dbec87ffbb9e02fe82f4a32c08563465dac
```

# 1. Introduction
# 2. Objective
# 3. Dataset Preparation
Our analysis focuses on the data of year 2012 -2013 of 23 variables. We chose the median income 6 years after graduation as our predictor variable, and eliminated many fields with bunch of missing values as well as some fields not pertainig enougn to post-graduation income. We then fosued primarily on a set of 23 variables, including gender, age, ethnic, acedemic costs, family income, completetion rates and replayment rate.  


The following libraries have been used in the analysis: 
```{r, message=FALSE,warning=FALSE}

library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(plyr)

```


We loaded ScoreCard from the US Dapartment of Education. The main dataset spans nearly 20 years of data and covering multiple sources including IPEDS, NSLDS, and Department of Treasury. To ensure the maximum data accurary and availablity, we choose the subset of year 2012 - 2013 as our analysis sample. 
```{r, message=FALSE,warning=FALSE}

data = read.csv("MERGED2012_13_PP.csv",header = T, na.strings = "NULL")
data = read.csv("MERGED2012_13_PP.csv",header = T, na.strings = c("NULL","PrivacySuppressed"))

```

The full dataset contains 1743 variables. 36 variables were intially selected to analyze.
```{r, message=FALSE,warning=FALSE}

variable = select(data, STABBR, PREDDEG, LOCALE2, MENONLY, WOMENONLY, CONTROL, ADM_RATE, SATMTMID, SATVRMID, SATWRMID, SAT_AVG,
                  NPT4_PUB,
                  NPT4_PRIV,
                  UG,
                  UG_NRA,
                  UG_UNKN,
                  UG_WHITENH,
                  UG_BLACKNH,
                  UG_API,
                  UG_AIANOLD,
                  UG_HISPOLD,
                  DEP_STAT_PCT_IND,
                  PAR_ED_PCT_1STGEN,
                  MD_FAMINC,
                  MEDIAN_HH_INC,
                  POVERTY_RATE,
                  PCTPELL,
                  PCTFLOAN,
                  GRAD_DEBT_MDN,
                  WDRAW_DEBT_MDN,
                  APPL_SCH_PCT_GE2,
                  C150_4,
                  MD_EARN_WNE_P6,
                  MD_EARN_WNE_P10,
                  RPY_3YR_RT_SUPP,
                  CDR3)

<<<<<<< HEAD
=======

>>>>>>> 37842095441e9def6a991afaf6c36c8b81d5403c
```






After loading the dataset, we change variables to the correct data types. 
```{r, message=FALSE,warning=FALSE}



#numeric
variable[,-c(1,2,6)] %>%
    apply(2, as.numeric) %>%
    as.data.frame() %>%
    {.} -> variable_num

#categorical
variable$preF=factor(variable$PREDDEG,levels=c(0,1,2,3,4),labels = c("NotClassified","Certificate-degree","Associate's-degree","Bachelor's-degree","Graduate-degree"))
variable$ctrF=factor(variable$CONTROL,levels = c(1,2,3),labels = c("Public","Private Nonprofit","Private For-profit"))

#combine the three datafram to generate a new dataset. 
<<<<<<< HEAD
data_new <- cbind(variable_num,variable$preF, variable$ctrF,variable$STABBR)



=======
data_new <- cbind(variable_num, variable$preF, variable$ctrF,variable$STABBR)
>>>>>>> 344d8dbec87ffbb9e02fe82f4a32c08563465dac
dim(data_new)

mean(is.na(data_new$NPT4_PUB))

```




Considering the variable NPT4_PUB and NPT4_PRIV are mutually exclusive, to maximize the data integrity, we integrated the information of the two coloumns into a single cololumn, named with "NPT4_COMBINE". The new coloumn records the average net price for TITLE IV institutions of both public and private. 
```{r, message=FALSE,warning=FALSE}

for (i in 1:length(data_new$NPT4_PRIV)) {
   if (is.na(data_new$NPT4_PRIV[i])) {
       data_new$NPT4_PRIV[i] = data_new$NPT4_PUB[i]
   }
}
mean(is.na(data_new$NPT4_PRIV))
data_new = data_new[,-9]
colnames(data_new)[9] <- "NPT4_COMBINE"
```


In order to choose the variables that have enough valid data related to the topic, we filtered and considered variables with percent missing value less than 25%. The new data set was named as “data_clean” for further analysis. 
```{r, message=FALSE,warning=FALSE}

data_clean = data_new[,colMeans(is.na(data_new)) < 0.25]
write.csv(data_clean,"data_clean.csv")
```

#Variable summary
For numeric variabls, we calculate the basic summary statistics such as median, min, max, mode and quantile. We also use visualizations such as hisgroms and boxplots to understand the distribution of the values. For categorical variables, we use frequency table to understand the frequcies of each categories.Box chart is used as a visualization tool.


=======
The table below lists the variables that will be used for the further analysis: 12 of them are continuous variables while 3 of them are categorical variables. Our data set now contains 120 rows and 15 columns. 120 rows consist of 20 years’ of data for each of the chosen six countries. The 15 columns consist of country name, country code, year, and the twelve indicators.

<<<<<<< HEAD

| Variable Name    | Data Type         | Categorical or Continuous         | Group       |
| --------------  | ----------------- | --------------------------------- | -------- |
| NPT4_COMBINE    | Numeric           |  Continuous                       |  Cost    |
=======
| Variable Name    | Data Type         | Description                                                         | Categoriy in Documentation       |
| --------------  | ------------------ | ---------------------------------------------------------------------| --------------------------------|
| NPT4_COMBINE    | Numeric            |average net price for TITLE IV institutions of both public and private.|  Cost                           |
| DEP_STAT_PCT_IND | Numeric           |Percentage of students who are financially independent                |     Cost                        |
| PAR_ED_PCT_1STGEN| Numeric           |Percentage first-generation students                                  |      Sudent Body                |
| MD_FAMINC        | Numeric           |Median family income in real 2015 dollars                             |       Earning                   |
| PCTPELL          | Numeric           |Percentage of undergraduates who receive a Pell Grant                 |        Financial Aid            |
| PCTFLOAN         | Numeric           |Percent of all federal undergraduate students receiving a federal student loan      |  Financial Aid    |
| GRAD_DEBT_MDN    | Numeric           |The median debt for students who have completed                       |   Financial Aid                 |
| WDRAW_DEBT_MDN   | Numeric           |  Continuous                       |    n     |
| MD_EARN_WNE_P6   | Numeric           |  Continuous                       |     n    |
| MN_EARN_WNE_P10  | Numeric           |  Continuous                       |       n  |
| RPY_3YR_RT_SUPP  | Numeric           |  Continuous                       |      n   |
>>>>>>> 344d8dbec87ffbb9e02fe82f4a32c08563465dac
| CDR3             | Numeric           |  Continuous                       | n        |
| variable$qreF    | Factor            |  Categorical                      |  n       |
| variable$ctrF    | Factor            |  Categorical                      |   n      |
| variable$STABBR  | Factor            |  Categorical                      |   n      |
| DEP_STAT_PCT_IND | Numeric           |  Continuous                       |     Student    |
| PAR_ED_PCT_1STGEN| Numeric           |  Continuous                       |      Student   |
| MD_FAMINC        | Numeric           |  Continuous                       |       Student  |
| PCTPELL          | Numeric           |  Continuous                       |Aid         |
| PCTFLOAN         | Numeric           |  Continuous                       | Aid        |
| GRAD_DEBT_MDN    | Numeric           |  Continuous                       |  Aid      |
| APPL_SCH_PCT_GE2 | Numeric           |  Continuous                       | Student        |
| WDRAW_DEBT_MDN   | Numeric           |  Continuous                       |    Aid     |
| MD_EARN_WNE_P6   | Numeric           |  Continuous                       |     Earning    |
| MD_EARN_WNE_P10  | Numeric           |  Continuous                       |       Earning  |
| RPY_3YR_RT_SUPP  | Numeric           |  Continuous                       |      Repayment   |
| CDR3             | Numeric           |  Continuous                       | Repayment        |
| variable$qreF    | Factor            |  Categorical                      |  School       |
| variable$ctrF    | Factor            |  Categorical                      |   School      |
| variable$STABBR  | Factor            |  Categorical                      |   School      |

##School

###1. State
State variable has 59 levels, which include 55 states in the United States, as well as......... From the following frequncy table, we see that California has the most University-equivalent institutions across the nation, followed by Texas and Ner York. It has about 800 universities! A bar chart is plotted below to show the top states with the most universities. Then summary of frequency table also shows that the state having the least university only has one, and 50% of state has more than 132 universities in the state.
```{r, message=FALSE}

state_freq = count(data_clean,"variable$STABBR")[order(-count(data_clean,'variable$STABBR')$freq),]
state_freq[1:15,]
summary(state_freq)
state_freq[1:15,] %>% ggplot(aes(x=factor(variable.STABBR), y=freq)) +
  geom_bar(stat = 'identity')

```

###2. Predominant Degree
Then we analyze the type of degree universities mainly offer. There are four types of degree taken into accout: Certificate-degree, Associate's degree, Bachelor's degree, and Graduate Degree. About 5% of the population are classified in terms of the predomiant degree they offer.  43.2% offer Certificate degree as their predominant degree, 27.3% predominantly offer Bachelor degree and only 4.23% are classified as Graduate degree predominant.

```{r, message=FALSE}
prop.table(table(data_clean$`variable$preF`)) * 100
data_clean %>% ggplot(aes(x=variable$`preF`, fill = 'blue')) + 
  geom_histogram(stat = "count") +
  xlab("Degree") 
```


###3. Control of Institution
In addition to State and predominant degree, control of institution is another categorical variable in the dataset. The label of Control is to indicate whether or not a institution is institution is privately owned and whether or not it is a for-profit organization. There are three levels of this variable: Public, Private Nonprofit, and Private-profit. Public school is assumed to be non-profit so it was not further divided into two subgroups. Below we show the percentage summary of each category and a bar char is plotted to facilitate understanding. About 50% out of all institution are private for-profit university, which is the *most dominant type*. Public and Private Nonprofit are pretty tie in terms of number of observation in each category.

```{r, message=FALSE}
prop.table(table(data_clean$`variable$ctrF`)) * 100
data_clean %>% ggplot(aes(x=variable$`ctrF`, fill = 'blue')) + 
  geom_histogram(stat = "count") +
  xlab("Degree")
```








##Student
###3. How many application do students submit?
The variable APPL_SCH_PCT_GE2 is to describe the percentage of students who list two and more than two institutions when he apply for financial aid when apply for universities. This information is only available to students who submit their applications for federal aid, and not cover the whole student body. Nevertheless, this variable still can provides some useful insights about how many universities a student usually apply to. 

The summry statistics show that median percentage of student submitting two or more than two application is 41.67 across all univerisities. The institution having the least percentage only has 4% of student applying to more than one university, while the school with the highest percent has as high as 90% of student applying to more than one university. The boxplot compare the the percent of student applying to only one university and that of student applying to more than 1. We can clearly see that a larger portion of students only list one instituiton when submitting their application for financial aid.
```{r, message=FALSE}
college_app_2_clean = data_clean$APPL_SCH_PCT_GE2[!is.na(data_clean$APPL_SCH_PCT_GE2)]*100
summary(college_app_2_clean)

college_app_2_clean %>% as.data.frame() %>%
    mutate(college_app_1 = 100-college_app_2_clean)%>%
    {.}  -> college_app
colnames(college_app)[1] <- "two_or_greater"

college_app %>% gather(key = num_app, value = perc_student) %>%
{.} -> college_app

college_app %>%
    ggplot(aes(factor(num_app), perc_student)) +
    geom_boxplot() 
```







##Cost
###1.Net Price






##Aid






###1. The median debt for students who have completed


###2. The median debt for students who have not completed
WDRAW_DEBT_MDN describe the median number of debt fot students who ahve not completed their study. In other words, they are still attending the university. The summary statistics show that student in 50% of institution have a median debt of 5500.The median debt for attending students can be as much as 27620 for some school and as low as 600 for other. So we also calculate standard deviation to measure the dispenser of the distribution. The standard deviation is 2415.623 about 95% of institution have a median debt ranging from 1167.754  to 10830.246. The histogram that the distribution of the median roughly follows a standard distribution with a sharp peak and slightly heavy tail.

```{r, message=FALSE}
median_debt_non_null = data_clean$WDRAW_DEBT_MDN[!is.na(data_clean$WDRAW_DEBT_MDN)]
summary(median_debt_non_null)
sd(median_debt_non_null)

#plot a ggplot to better illustrate
data_clean %>% ggplot(aes(x = WDRAW_DEBT_MDN)) +
                geom_histogram(binwidth = 450) #warning?

ggplot(data=data_clean,
       aes(x=WDRAW_DEBT_MDN,
           fill = I('red'))) +
    geom_density(alpha=0.5) +
    scale_x_continuous("Median Debt for Students Who Have Completed")
=======
we will summarize the data set using dplyr functions in the variables summary section.

#4 Goals
#5 Summary of variables
##5.1 Individual variable summary

###5.1.1 Average net price for Title IV institutions(both public and private institutions)
We are using the code below to summarize the variable. 

```{R, message=FALSE, warinig = FALSE}


summarize(data_clean,
          minNPT4_COMBINE=min(NPT4_COMBINE ,na.rm=TRUE),
          maxNPT4_COMBINE=max(NPT4_COMBINE,na.rm=TRUE),
          meanNPT4_COMBINE=mean(NPT4_COMBINE,na.rm=TRUE),
          medianNPT4_COMBINE=median(NPT4_COMBINE,na.rm=TRUE),
          sdNPT4_COMBINE = sd(NPT4_COMBINE,na.rm=TRUE))



```
From the summary results, we learned that the maximum value of the variable is \$87,414 while the minimum value is about \$-19,360. Considering the elements are collected from Title IV institutions, we reasoned that the negative values may be due to the fact that some intituions's finainal aid supoort can cover the students' all the costs, meanwhile overbalancing the cost amount. There are not much differerences between mean value and median value, which is around \$15,000. We can conclude that the average net price costs for most institutuins are falling into the this range. The standard deviation value is 7604.884 which is relatively large, indicating a great spread in the data. 


Below is the histogram for this variable which is able to provide us with a visual distrubution presentation. 
```{R}

#histogram for NPT_COM
  ggplot(data=data_clean , aes(NPT4_COMBINE)) + 
    geom_histogram(breaks=seq(0, 90000, by =2000), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for NPT_COM") +
<<<<<<< HEAD
    labs(x="NPT_COM", y="Count")
>>>>>>> 37842095441e9def6a991afaf6c36c8b81d5403c
=======
    labs(x="NPT_COM", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, we notice that the average net cost for IV institutions typically is 16000 -18000. The values between 16000 - 20000 are quite frequent. There were an unsually lagrge number of costs. The institutions with cost of more than 50000 were atypical. Due to the atypical large value, the histogram is abviously right skewed. Without those extreme values, the histogram would be reasonably symmetric. 


Then we grouped by the data into the state level to take a further analysis.
```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(variable$STABBR) %>%
    summarise(minNPT4_COMBINE=min(NPT4_COMBINE ,na.rm=TRUE),    
    maxNPT4_COMBINE=max(NPT4_COMBINE,na.rm=TRUE),medianNPT4_COMBINE=median(NPT4_COMBINE,na.rm=TRUE))  %>%
       arrange(desc(medianNPT4_COMBINE))   %>%
{.}  ->NPT4_STATE

NPT4_STATE

```
Baesd on the output, we can see the highest median value for avreage net price exists in DC while the lowest median value is in AS(American Samoa).Moreover, we found that the top 5 states are DC, VT, MA, NH, RI, which are all states conceiving amount of well-known educational institutions. 


###5.1.2 Percentage of students who are financially independent

Here is the code to generate the summary statistics: 
```{R}


summarize(data_clean,
          minDEP_STAT_PCT_IND=min(DEP_STAT_PCT_IND*100 ,na.rm=TRUE),
          maxDEP_STAT_PCT_IND=max(DEP_STAT_PCT_IND*100,na.rm=TRUE),
          meanDEP_STAT_PCT_IND=mean(DEP_STAT_PCT_IND*100,na.rm=TRUE),
          medianDEP_STAT_PCT_IND=median(DEP_STAT_PCT_IND*100,na.rm=TRUE),
          sdDEP_STAT_PCT_IND = sd(DEP_STAT_PCT_IND*100,na.rm=TRUE))



```
From the summary results, we learned that the maximum value of the variable is 98.56% while the minimum value is about 0，73%. From the mean value, we can tell that about in most colleges, around 56% of the students are financially independent. The standatd deviation value of 23.3% indicates a relative high different among different colleges, which can also be concluded from the difference between maximum value and minimum value. Below is the code to generate a visual representation in the histgram. 
```{R}

  #histogram for NPT_COM
  ggplot(data=data_clean , aes(DEP_STAT_PCT_IND)) + 
    geom_histogram(breaks=seq(0.1, 1, by =0.1), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for DEP_STAT_PCT_IND") +
    labs(x="DEP_STAT_PCT_IND", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, we notice that the value between 0.7 to 0.8 are quite frequent. There was no obvious extrme value in the sample, thus the histogram is normally distributed. 

Then we grouped by the data into the control type(Private For-profit, Public, Private Nonprofit) to take a further analysis.
```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(variable$ctrF) %>%
    summarise(minDEP_STAT_PCT_IND=min(DEP_STAT_PCT_IND ,na.rm=TRUE),    
    maxDEP_STAT_PCT_IND=max(DEP_STAT_PCT_IND,na.rm=TRUE),medianDEP_STAT_PCT_IND=median(DEP_STAT_PCT_IND,na.rm=TRUE))  %>%
       arrange(desc(medianDEP_STAT_PCT_IND))   %>%
{.}  ->DEP_STAT_PCT_IND_CONTROL

DEP_STAT_PCT_IND_CONTROL

```
From the result, we can tell the highest median value is in Privately For-profit colleges, which means that in most private for-profit colleges, the students are more likely to be financial independent. 




###5.1.3 Percentage first-generation students
This element identifies the share of federally aided students at the institution who report that they are first generaion on the FAFSA (Free Application for Federal Student Aid). First generation students are defined as sudents in which neither parents completed college. 

We are using the code below to summarize this variable. 

```{R, message=FALSE, warinig = FALSE}


summarize(data_clean,
          minPAR_ED_PCT_1STGEN=min(PAR_ED_PCT_1STGEN*100 ,na.rm=TRUE),
          maxPAR_ED_PCT_1STGEN=max(PAR_ED_PCT_1STGEN*100,na.rm=TRUE),
          meanPAR_ED_PCT_1STGEN=mean(PAR_ED_PCT_1STGEN*100,na.rm=TRUE),
          medianPAR_ED_PCT_1STGEN=median(PAR_ED_PCT_1STGEN*100,na.rm=TRUE),
          sdPAR_ED_PCT_1STGEN = sd(PAR_ED_PCT_1STGEN*100,na.rm=TRUE))



```
From the output, we can tell that the highest value is 95.25% while the lowest value is 6.87%. From the mean value of 48.08%, we can tell that about for federally aided students in most colleges, around half (50.8%) of the students' parents did not complete the college. The standard deviation value of 12.2% indicated a relative high difference of this element among different colleges. Below is the code to generate a visual representation in the histgram. 
```{R}

 
  ggplot(data=data_clean , aes(PAR_ED_PCT_1STGEN)) + 
    geom_histogram(breaks=seq(0.1, 1, by =0.1), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for PAR_ED_PCT_1STGEN") +
    labs(x="PAR_ED_PCT_1STGEN", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, we can tell the share of first generarion students is most frequently falling into the range between 0.5 and 0.6. The value with the value more than 0.8 are rare. The colleges with the share of first generarion students value less than 0.5 are much more than the ones with the value larger than 0.5. Thus the histogram is seriously left skewed. 

Then we grouped by the data into the state level to take a further analysis.
```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(variable$STABBR ) %>%
    summarise(minPAR_ED_PCT_1STGEN=min(PAR_ED_PCT_1STGEN ,na.rm=TRUE),    
    maxPAR_ED_PCT_1STGEN=max(PAR_ED_PCT_1STGEN,na.rm=TRUE),medianPAR_ED_PCT_1STGEN=median(PAR_ED_PCT_1STGEN,na.rm=TRUE))  %>%
       arrange(medianPAR_ED_PCT_1STGEN)   %>%
{.}  ->PAR_ED_PCT_1STGEN_STATE

PAR_ED_PCT_1STGEN_STATE

data_clean %>%
  group_by(variable$ctrF ) %>%
    summarise(minPAR_ED_PCT_1STGEN=min(PAR_ED_PCT_1STGEN ,na.rm=TRUE),    
    maxPAR_ED_PCT_1STGEN=max(PAR_ED_PCT_1STGEN,na.rm=TRUE),medianPAR_ED_PCT_1STGEN=median(PAR_ED_PCT_1STGEN,na.rm=TRUE))  %>%
       arrange(desc(medianPAR_ED_PCT_1STGEN))   %>%
{.}  ->PAR_ED_PCT_1STGEN_STATE

PAR_ED_PCT_1STGEN_STATE



```

The results showed that the universities located in ND, SD, VT, MN and MT had the lowest value of Percentage first-generation students, which indicated that the students in thoses five states would have a better family education background. The five states with the highest share of parents first-generation are LA, NJ, MP, MV, MH. 





###5.1.4 Median family income in real 2015 dollars
This elemnt is recording the median family income of students, one of the undergraduate student demographics for earnings cohorts. 

We are using the code below to summarize this variable. 

```{R, message=FALSE, warinig = FALSE}


summarize(data_clean,
          minMD_FAMINC=min(MD_FAMINC ,na.rm=TRUE),
          maxMD_FAMINC=max(MD_FAMINC,na.rm=TRUE),
          meanMD_FAMINC=mean(MD_FAMINC,na.rm=TRUE),
          medianMD_FAMINC=median(MD_FAMINC,na.rm=TRUE),
          sdMD_FAMINC = sd(MD_FAMINC,na.rm=TRUE))



```
From the output, we can tell that the highest value is 155,606.6	 while the lowest value is 0. From the median value of 19,262.26, we can tell that among the colleges in the sample, the students in half of them had the family income below 19,262.26	. The standard deviation value is 18,824.31,  indicating a relative high difference of this element among different colleges. Below is the code to generate a visual representation in the histgram. 

```{R}

 
  ggplot(data=data_clean , aes(MD_FAMINC)) + 
    geom_histogram(breaks=seq(0, 156000, by =3000), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for MD_FAMINC") +
    labs(x="MD_FAMINC", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, we are able to conclude that in most colleges, students' family income are falling into the range of 12,000 - 18,000. Due to the atypical large values, the histogram is obviouslu skewed to right. The value larger than 18,000 are tend to be extreme and the cases larger than 75000 are rare and atypical, which means rare colleges have the students with family income more than 75000.



###5.1.5 Percentage of undergraduates who receive a Pell Grant

This elemnt, pulled from the IPEDS student Financial Aid Component, shows the share of undergraduate students who received Pell Grants in a given year, which is an important measure of the access an insiitution provides to low-income students. 
We are using the code below to summarize this variable. 

```{R, message=FALSE, warinig = FALSE}


summarize(data_clean,
          minPCTPELL=min(PCTPELL*100 ,na.rm=TRUE),
          maxPCTPELL=max(PCTPELL*100,na.rm=TRUE),
          meanPCTPELL=mean(PCTPELL*100,na.rm=TRUE),
          medianPCTPELL=median(PCTPELL*100,na.rm=TRUE),
          sdPCTPELL = sd(PCTPELL*100,na.rm=TRUE))



```
From the output, we can tell that the range is between 0 to 100%.	 Among the colleges in the sample, half colleges have this rate as high as 52.7% (median value of 52.7%), which means more than half of undergraduare students are able to receive the Pell Grant to cover their costs. The standard deviation value is 22.57%,  indicating a relative high difference of this element among different colleges, which can also be noticed from the largest range (100%). Below is the code to generate a visual representation in the histgram. 

```{R}

 
  ggplot(data=data_clean , aes(PCTPELL)) + 
    geom_histogram(breaks=seq(0, 1, by =0.1), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for PCTPELL") +
    labs(x="PCTPELL", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, we are able to conclude that in most colleges, 40% to 50% of the undergraduate students are able to receive the Pell Grant. With little skewness, the histogram is resonalbe symmetric. 

Then we grouped by the data into the college type level to take a further analysis.
```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(variable$ctrF ) %>%
    summarise(minPCTPELL=min(PCTPELL ,na.rm=TRUE),    
    maxPCTPELL=max(PCTPELL,na.rm=TRUE),medianPCTPELL=median(PCTPELL,na.rm=TRUE))  %>%
       arrange(medianPCTPELL)   %>%
{.}  ->PCTPELL_CONTROL

PCTPELL_CONTROL



>>>>>>> 344d8dbec87ffbb9e02fe82f4a32c08563465dac
```
From the result, the Private Nonprofit institutions and Public institutions have a similar low median values while the provate For- profit institutions have a hgihest value. This is resonable because generally speanking, the private for-profit colleges may have much higher costs than the private nonprofit and public institutions. The low-income students were more likely to seek a Pell Grant for assistant. Additionally, in some states, state financial aid may be sufficient to cover costs at community colleges; thus the students in thoes schools may not need to seek for addtional financial aid like Pell Grant.


###5.1.6 Percent of all federal undergraduate students receiving a federal student loan

This elemnt, as reported in the IPEDs Student Finaicial Aid component, show the share of undergraduate students who received federal loans in a given year. It can provide important context to figures related to debt, repayment and non-repayment.  
We are using the code below to summarize this variable. 

```{R, message=FALSE, warinig = FALSE}


summarize(data_clean,
          minPCTFLOAN=min(PCTFLOAN*100 ,na.rm=TRUE),
          maxPCTFLOAN=max(PCTFLOAN*100,na.rm=TRUE),
          meanPCTFLOAN=mean(PCTFLOAN*100,na.rm=TRUE),
          medianPCTFLOAN=median(PCTFLOAN*100,na.rm=TRUE),
          sdPCTFLOAN = sd(PCTFLOAN*100,na.rm=TRUE))



```
From the output, we can tell that the range is between 0 to 100%.	 Among the colleges in the sample, half colleges have this rate as high as 60.08% , which means around 60% of undergraduare students are able to receive the fedaral student loans. The standard deviation value is 29.26%,  indicating a relative high difference of this element among different colleges, which can also be noticed from the largest range (100%). Below is the code to generate a visual representation in the histgram. 

```{R}

 
  ggplot(data=data_clean , aes(PCTFLOAN)) + 
    geom_histogram(breaks=seq(0, 1, by =0.1), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for PCTFLOAN") +
    labs(x="PCTFLOAN", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, it's obvious that there are two peaks in the graph. The rates between 0- 10% and the rates between 60% to 80% are similarly frequent compated to the other ranges.  
 

Then we grouped by the data into the college type level to take a further analysis.
```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(variable$STABBR ) %>%
    summarise(minPCTFLOAN=min(PCTFLOAN ,na.rm=TRUE),    
    maxPCTFLOAN=max(PCTFLOAN,na.rm=TRUE),medianPCTFLOAN=median(PCTFLOAN,na.rm=TRUE))  %>%
       arrange(medianPCTFLOAN)   %>%
{.}  ->PCTFLOAN_STATE

PCTFLOAN_STATE


data_clean %>%
  group_by(variable$ctrF ) %>%
    summarise(minPCTFLOAN=min(PCTFLOAN ,na.rm=TRUE),    
    maxPCTFLOAN=max(PCTFLOAN,na.rm=TRUE),medianPCTFLOAN=median(PCTFLOAN,na.rm=TRUE))  %>%
       arrange(medianPCTFLOAN)   %>%
{.}  ->PCTFLOAN_CONTROL

PCTFLOAN_CONTROL



```
From the result, the Private institutions have a much larger value than the public institutions. With a much higher costs burden, it makes sence that the low-income sutdents in private institutions are much more likely to seek financial aid than the public institution students. 



###5.1.7 The median debt for students who have completed
GRAD_DEBT_MDN


This element is the median loan debt acculated at the institution by all student borrowers of federal lonans who have habe completed the education.We are using the code below to summarize this variable. 
```{R, message=FALSE, warinig = FALSE}


summarize(data_clean,
          minGRAD_DEBT_MDN=min(GRAD_DEBT_MDN ,na.rm=TRUE),
          maxGRAD_DEBT_MDN=max(GRAD_DEBT_MDN,na.rm=TRUE),
          meanGRAD_DEBT_MDN=mean(GRAD_DEBT_MDN,na.rm=TRUE),
          medianGRAD_DEBT_MDN=median(GRAD_DEBT_MDN,na.rm=TRUE),
          sdGRAD_DEBT_MDN = sd(GRAD_DEBT_MDN,na.rm=TRUE))


```
From the output, we can tell that the highest value is 48,250	 while the lowest value is 1448. From the median value of 14000, we can tell that among the colleges in the sample, the students who have completed the deducaiton from half of them had the median loan debt of 14000. The standard deviation value is 8020.958,  indicating a relative high difference of this element among different colleges. Below is the code to generate a visual representation in the histgram. 

```{r}

 ggplot(data=data_clean , aes(GRAD_DEBT_MDN)) + 
    geom_histogram(breaks=seq(0, 50000, by =2000), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for GRAD_DEBT_MDN") +
    labs(x="GRAD_DEBT_MDN", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))

```
From the histogram, it is obvious that most students in the sampled colleges still have 8000- 10000 debt amount after they completed the education. This amount is related to the federal loan amount provided by each institution. Additionally, it is asscociated with students' ability to repay the loan during the acdemic period. For example, for the students who were capabiblity of working through the acedemic years or securing jobs before graduation may have a less value for this variable. 



<<<<<<< HEAD
##Earning

###. Earning after graduation

We selected two variables MD_EARN_WNE_P6, MD_EARN_WNE_P10 in the earning group to study students' post-graduation earning. MD_EARN_WNE_P6 is the median earning for students six years after their entry, which corresponds to two years after gradutaion. Likewise, MD_EARN_WNE_P10 is the median earning ten years after their entry, which corresponds to four years after graduation. These two metrics give us an idea of how much money students are making after their graduation, in both short and medium terms,

In addition to these two variables, a derived variable is also calculated as the difference between the salary 2 years post-graduation and another two years later. The median earning of 50% institutions is below the 25300 below, while the maximum median earining is 120200. After two years, the median earning increase by about $5500. The histogram gives a more clear idea of the earning distribution. Most of institution with students having a median earining between 10000 to 50000 two years after graduation. The distribution of earining 4 years after graduation falls at the right of the distribution of 2 years post-graduation, which means that the earning increases as students' experience increase. Beside, the fout-year post-graduation earning has a wider spread than that of two years. That indicate that the there is a greater gap between who are earning more and who are earning less, which can be confirmed by the increase in standard deviation.


```{r,message=FALSE}
earning = select(data_clean, MD_EARN_WNE_P6, MD_EARN_WNE_P10 )
earning_clean = na.omit(earning)
earning_clean %>%
    mutate(salary_increase = MD_EARN_WNE_P10-MD_EARN_WNE_P6) %>%
    {.} -> earning_clean
summary(earning_clean)
apply(earning_clean, 2, sd) #dispersion increases

earning_clean %>% gather(key = years_from_entry, value = salary) %>%
    {.} -> earning_clean1

earning_clean1[earning_clean1$years_from_entry != 'salary_increase',] %>% 
    ggplot(aes(x = salary, fill =years_from_entry )) +
    geom_density(alpha = 0.5) + 
    xlim(0, 150000)


```
    
=======

##5.2 Relationship between variables
PCTPELL vs family income 
PCTFLOAN vs family income
PCTPELL vs NPT4
PCTPELL  VS family independent
family independent   vs family income 
first generation vs family income
pell vs control
pell vs degree type
pell vs states
loan vs debt, repayment, non-repay
loan vs cost 

loan vs control




##5.3 Comparison between variables
PCTPELL vs PCTFLOAN



#6. Findings and Conclusion
>>>>>>> 37842095441e9def6a991afaf6c36c8b81d5403c
    
##Repayment

###1. 3-year Repayment rate
The variable RPY_3YR_RT_SUPP measure the percentage of student who entered repayemtn from October 1, 2010 to September 30, 2011, and made progress in the following three years. Repayment rates are generally considered most sensitive than default rates(we study later), which measure only the worse-case scenario for repayment outcomes. From the summary statistics, we see that 50% institutions have 40% of students who are making progress in their repayment. A histogram is also plotted to show the distribution, clearly with a heavy tail. 

```{r,message=FALSE}
repayment_clean = na.omit(data_clean$RPY_3YR_RT_SUPP)
summary(repayment_clean)
qplot(repayment_clean, geom = "histogram")
```

###2. 3-year Default rate
The three-year cohort default rate describe the repayment in the opposite of repayment rate. In this dataset, it was calculated using the cohort of borrowers who entered repayment on their federal student loans between Octorber 1, 2010 to September 30, 2011, and who defaulted before September 2012. The median default rate aross all universities is 13%, which means that 50% of universities have 13 out of 100 students defaulted their loan! 

```{r,message=FALSE}
default_clean = na.omit(data_clean$CDR3)
summary(default_clean)
qplot(default_clean, geom = "histogram")

summary(data_clean$RPY_3YR_RT_SUPP + data_clean$CDR3)
```
HU

