---
title: "Draft-assinment1"
author: "Kun Shen, Xiang Li, Xue Zhou"
date: "February 10, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Introduction
# 2. Objective
# 3. Dataset Preparation
Our analysis focuses on the data of year 2012 -2013 of 23 variables. We chose the median income 6 years after graduation as our predictor variable, and eliminated many fields with bunch of missing values as well as some fields not pertainig enougn to post-graduation income. We then fosued primarily on a set of 23 variables, including gender, age, ethnic, acedemic costs, family income, completetion rates and replayment rate.  


The following libraries have been used in the analysis: 
```{r, message=FALSE}

library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(plyr)

```


We loaded ScoreCard from the US Dapartment of Education. The main dataset spans nearly 20 years of data and covering multiple sources including IPEDS, NSLDS, and Department of Treasury. To ensure the maximum data accurary and availablity, we choose the subset of year 2012 - 2013 as our ..... 
```{r, message=FALSE}

data = read.csv("MERGED2012_13_PP.csv",header = T, na.strings = "NULL")
data = read.csv("MERGED2012_13_PP.csv",header = T, na.strings = c("NULL","PrivacySuppressed"))

```

The full dataset contains 1743 variables. 36 variables were intially selected to analyze.
```{r, message=FALSE}

variable = select(data, STABBR, PREDDEG, LOCALE2, MENONLY, WOMENONLY, CONTROL, ADM_RATE, SATMTMID, SATVRMID, SATWRMID, SAT_AVG,
                  NPT4_PUB,
                  NPT4_PRIV,
                  UG,
                  UG_NRA,
                  UG_UNKN,
                  UG_WHITENH,
                  UG_BLACKNH,
                  UG_API,
                  UG_AIANOLD,
                  UG_HISPOLD,
                  DEP_STAT_PCT_IND,
                  PAR_ED_PCT_1STGEN,
                  MD_FAMINC,
                  MEDIAN_HH_INC,
                  POVERTY_RATE,
                  PCTPELL,
                  PCTFLOAN,
                  GRAD_DEBT_MDN,
                  WDRAW_DEBT_MDN,
                  APPL_SCH_PCT_GE2,
                  C150_4,
                  MD_EARN_WNE_P6,
                  MD_EARN_WNE_P10,
                  RPY_3YR_RT_SUPP,
                  CDR3)

```






After loading the dataset, we change variables to correct data types. 
```{r, message=FALSE}



#numeric
variable[,-c(1,2,6)] %>%
    apply(2, as.numeric) %>%
    as.data.frame() %>%
    {.} -> variable_num

#categorical
variable$preF=factor(variable$PREDDEG,levels=c(0,1,2,3,4),labels = c("NotClassified","Certificate-degree","Associate's-degree","Bachelor's-degree","Graduate-degree"))
variable$ctrF=factor(variable$CONTROL,levels = c(1,2,3),labels = c("Public","Private Nonprofit","Private For-profit"))

#combine
data_new <- cbind(variable_num,variable$preF, variable$ctrF,variable$STABBR)

```

Deal with missing values



```{r, message=FALSE}

for (i in 1:length(data_new$NPT4_PRIV)) {
   if (is.na(data_new$NPT4_PRIV[i])) {
       data_new$NPT4_PRIV[i] = data_new$NPT4_PUB[i]
   }
}
mean(is.na(data_new$NPT4_PRIV))
data_new = data_new[,-9]
colnames(data_new)[9] <- "NPT4_COMBINE"
```

Deal with missing values
```{r, message=FALSE}

data_clean = data_new[,colMeans(is.na(data_new)) < 0.25]
write.csv(data_clean,"data_clean.csv")
```

#Variable summary
For numeric variabls, we calculate the basic summary statistics such as median, min, max, mode and quantile. We also use visualizations such hisgroms and boxplots to understand the distribution of the values. For categorical variables, we use frequency table to understand the frequcies of each categories.Box chart is used as a visualization tool.


| Variable Name    | Data Type         | Categorical or Continuous         | Group       |
| --------------  | ----------------- | --------------------------------- | -------- |
| NPT4_COMBINE    | Numeric           |  Continuous                       |  Cost    |
| CDR3             | Numeric           |  Continuous                       | n        |
| variable$qreF    | Factor            |  Categorical                      |  n       |
| variable$ctrF    | Factor            |  Categorical                      |   n      |
| variable$STABBR  | Factor            |  Categorical                      |   n      |
| DEP_STAT_PCT_IND | Numeric           |  Continuous                       |     Student    |
| PAR_ED_PCT_1STGEN| Numeric           |  Continuous                       |      Student   |
| MD_FAMINC        | Numeric           |  Continuous                       |       Student  |
| PCTPELL          | Numeric           |  Continuous                       |Aid         |
| PCTFLOAN         | Numeric           |  Continuous                       | Aid        |
| GRAD_DEBT_MDN    | Numeric           |  Continuous                       |  Aid      |
| APPL_SCH_PCT_GE2 | Numeric           |  Continuous                       | Student        |
| WDRAW_DEBT_MDN   | Numeric           |  Continuous                       |    Aid     |
| MD_EARN_WNE_P6   | Numeric           |  Continuous                       |     Earning    |
| MD_EARN_WNE_P10  | Numeric           |  Continuous                       |       Earning  |
| RPY_3YR_RT_SUPP  | Numeric           |  Continuous                       |      Repayment   |
| CDR3             | Numeric           |  Continuous                       | Repayment        |
| variable$qreF    | Factor            |  Categorical                      |  School       |
| variable$ctrF    | Factor            |  Categorical                      |   School      |
| variable$STABBR  | Factor            |  Categorical                      |   School      |

##School

###1. State
```{r, message=FALSE}
state_freq = count(data_clean,"variable$STABBR")[order(-count(data_clean,'variable$STABBR')$freq),]
state_freq[1:15,]
data_clean$STABBR1 <- with(data_clean, reorder(variable$STABBR, variable$STABBR, function(x) -length(x)))
data_clean %>% ggplot(aes(x= STABBR1)) +
  geom_histogram(stat = "count") 
```

###2. Predominant Degree
```{r, message=FALSE}
prop.table(table(data_clean$`variable$preF`)) * 100
data_clean %>% ggplot(aes(x=variable$`preF`, fill = 'blue')) + 
  geom_histogram(stat = "count") +
  xlab("Degree") 
```


###3. Control of Institution

```{r, message=FALSE}
prop.table(table(data_clean$`variable$ctrF`)) * 100
data_clean %>% ggplot(aes(x=variable$`ctrF`, fill = 'blue')) + 
  geom_histogram(stat = "count") +
  xlab("Degree")
```








##Student
###3. How many application do students submit?
```{r, message=FALSE}
college_app_2_clean = data_clean$APPL_SCH_PCT_GE2[!is.na(data_clean$APPL_SCH_PCT_GE2)]*100
summary(college_app_2_clean)

college_app_2_clean %>% as.data.frame() %>%
    mutate(college_app_1 = 100-college_app_2_clean)%>%
    {.}  -> college_app
colnames(college_app)[1] <- "two_or_greater"

college_app %>% gather(key = num_app, value = perc_student) %>%
{.} -> college_app

college_app %>%
    ggplot(aes(factor(num_app), perc_student)) +
    geom_boxplot() 
```






##Cost
###1.Net Price






##Aid






###1. The median debt for students who have completed


###2. The median debt for students who have not completed
```{r, message=FALSE}
median_debt_non_null = data_clean$WDRAW_DEBT_MDN[!is.na(data_clean$WDRAW_DEBT_MDN)]
summary(median_debt_non_null)
sd(median_debt_non_null)

#plot a ggplot to better illustrate
data_clean %>% ggplot(aes(x = WDRAW_DEBT_MDN)) +
                geom_histogram(binwidth = 450) #warning?

ggplot(data=data_clean,
       aes(x=WDRAW_DEBT_MDN,
           fill = I('red'))) +
    geom_density(alpha=0.5) +
    scale_x_continuous("Median Debt for Students Who Have Completed")
```



##Earning

###. Earning after graduation
```{r,message=FALSE}
earning = select(data_clean, MD_EARN_WNE_P6, MD_EARN_WNE_P10 )
earning_clean = na.omit(earning)
earning_clean %>%
    mutate(salary_increase = MD_EARN_WNE_P10-MD_EARN_WNE_P6) %>%
    {.} -> earning_clean
summary(earning_clean)
apply(earning_clean, 2, sd) #dispersion increases

earning_clean %>% gather(key = years_from_entry, value = salary) %>%
    {.} -> earning_clean1

earning_clean1[earning_clean1$years_from_entry != 'salary_increase',] %>% 
    ggplot(aes(x = salary, fill =years_from_entry )) +
    geom_density(alpha = 0.5) + 
    xlim(0, 150000)
```
    
    
##Repayment

###1. 3-year Repayment rate
```{r,message=FALSE}
repayment_clean = na.omit(data_clean$RPY_3YR_RT_SUPP)
summary(repayment_clean)
qplot(repayment_clean, geom = "histogram")
```

###2. 3-year Default rate
```{r,message=FALSE}
default_clean = na.omit(data_clean$CDR3)
qplot(default_clean, geom = "histogram")

summary(data_clean$RPY_3YR_RT_SUPP + data_clean$CDR3)
```


