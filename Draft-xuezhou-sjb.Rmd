---
title: "Draft-assinment1"
author: "Kun Shen, Xiang Li, Xue Zhou"
date: "February 10, 2017"
output: html_document
---

```{r setup, include=FALSE,warning=FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE,warning=FALSE)
```

#Table of Contents
* 1.[Introduction](#Introduction)
* 2.[Goal](#Goal)
* 3.[Dataset Preparation](#dataprep)
* 4.[Objective](#objective)
* 5.[Summary of variables](#variablesummary)
 * 5.1 Individual variable summary
  * 5.1.1 School
    * 5.1.1.1 State
    * 5.1.1.2 Predominant Degree
    * 5.1.1.3 Control of Institution
  * 5.1.2 Student Body
    * 5.1.2.1 [Percentage first-generation students](#5.1.2.1)
    * 5.1.2.2 Number of applications
  * 5.1.3 Cost 
    * 5.1.3.1 [Average net price for Title IV institutions(both public and private institutions)](#5.1.3.1)
    * 5.1.3.2 [Percentage of students who are financially independent](#5.1.3.2)
  * 5.1.4 Financial Aid
    * 5.1.4.1 [Percentage of undergraduates who receive a Pell Grant](#5.1.4.1)
    * 5.1.4.2 [Percent of all federal undergraduate students receiving a federal student loan](#5.1.4.2l)
    * 5.1.4.3 [The median debt for students who have completed](#5.1.4.3)
    * 5.1.4.4 The median debt for students who have not completed
  * 5.1.5 Earning
    * 5.1.5.1 [Median family income in real 2015 dollars](#5.1.5.1)
    * 5.1.5.2 Earning after graduation
  * 5.1.6 Repayment
    * 5.1.6.1 3-year Repayment rate
    * 5.1.6.2 3-year Default rate
* 6.Relationship between variables
 * 6.1 [The relationship between NPT4_COMBINE and State](#6.1)
 * 6.2 [The relationship between Debt and Cost](#6.2)
 * 6.3 [The relationship between Percentage of Pell Grant and college type(CONTROL)](#6.3)
 * 6.4 [The relationship between Percentage first-generation students and States](#6.4)
 * 6.5 [The relationship between family income and percentage of Pell Grant](#6.5)
 * 6.6 [The relationship between DEP_STAT_PCT_IND and Control](#6.6)
 * 6.7 [The relationship between PCTLOAN and Control](#6.7)
 * 6.8 cost and median debts with earning
 * 6.9 default with earning
 * 6.10 degree type vs. earning
 * 6.11 predominant degree, control  and earning after 6 year of entry
 * 6.12 predominant degree + control (count)
 * 6.13 control + earning
 * 7. Findings and Conclusion
       


#1. Introduction<a id="Introduction"></a>
The College Scorecard project is designed to increase the transparency of the college data, working as a navigator for students to make informed decisions about their choice for higher education. The information gathered in the dataset also gives students and families more power to differentiate postsecondary institutions and get an idea about how well colleges are preparing their students to be successful. The dataset is created to address the lack of information about college costs, earnings, federal student aid, admission rate etc. The data provides insights into the performance of institutions that receive federal aid dollars, and the outcomes of the students of those institutions. It also gives extra support for students and families to weight the tradeoffs on choosing the right college according to their own needs and educational goals.

These data are collected by United States Department of Education with the goal of helping students and families make more educated decisions about college and compare vital information easily. 

#2. Goal<a id="Goal"></a>
#3. Dataset Preparation<a id="dataprep"></a>
Our analysis focuses on the data of year 2012 -2013 of 23 variables. We chose the median income 6 years after graduation as our predictor variable, and eliminated many fields with bunch of missing values as well as some fields not pertainig enougn to post-graduation income. We then fosued primarily on a set of 23 variables, including gender, age, ethnic, acedemic costs, family income, completetion rates and replayment rate.  


The following libraries have been used in the analysis: 
```{r, message=FALSE,warning=FALSE}

library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(ggvis)
library(plyr)

```


We loaded ScoreCard from the US Dapartment of Education. The main dataset spans nearly 20 years of data and covering multiple sources including IPEDS, NSLDS, and Department of Treasury. To ensure the maximum data accurary and availablity, we choose the subset of year 2012 - 2013 as our analysis sample. 
```{r, message=FALSE,warning=FALSE}

data = read.csv("MERGED2012_13_PP.csv",header = T, na.strings = c("NULL","PrivacySuppressed"))

```

Considering there is some special characters in the ID coloumn, we first rename the first column's name to be selectable. 
```{R}
colnames(data)[1] = 'UNITID'
```

The full dataset contains 1743 variables. 36 variables were intially selected to analyze.
```{r, message=FALSE,warning=FALSE}

variable = select(data, UNITID, INSTNM, STABBR, PREDDEG, LOCALE2, MENONLY, WOMENONLY, CONTROL, ADM_RATE, SATMTMID, SATVRMID, SATWRMID, SAT_AVG,
                  NPT4_PUB,
                  NPT4_PRIV,
                  UG,
                  UG_NRA,
                  UG_UNKN,
                  UG_WHITENH,
                  UG_BLACKNH,
                  UG_API,
                  UG_AIANOLD,
                  UG_HISPOLD,
                  DEP_STAT_PCT_IND,
                  PAR_ED_PCT_1STGEN,
                  MD_FAMINC,
                  MEDIAN_HH_INC,
                  POVERTY_RATE,
                  PCTPELL,
                  PCTFLOAN,
                  GRAD_DEBT_MDN,
                  WDRAW_DEBT_MDN,
                  APPL_SCH_PCT_GE2,
                  C150_4,
                  MD_EARN_WNE_P6,
                  MD_EARN_WNE_P10,
                  RPY_3YR_RT_SUPP,
                  CDR3)


```

After loading the dataset, we change variables to the correct data types. 
```{r, message=FALSE,warning=FALSE}

#need to be commented out 
class(as.data.frame(apply(variable[,-c(2,3,4,8)],2,as.numeric)))

#get rid of factor variables: INSTNM, STABBR, PREDDEG, CONTROL and change the data types to numeric 
variable[,-c(2,3,4,8)] %>%
    apply(2, as.numeric) %>%
    as.data.frame() %>%
    {.} -> variable_num

#change the categorical level of the categorical variables:PREDDEG, CONTROL
variable$preF=factor(variable$PREDDEG,levels=c(0,1,2,3,4),labels = c("NotClassified","Certificate-degree","Associate's-degree","Bachelor's-degree","Graduate-degree"))

variable$ctrF=factor(variable$CONTROL,levels = c(1,2,3),labels = c("Public","Private Nonprofit","Private For-profit"))

#combine the three datafram to generate a new dataset. 
data_new <- cbind(variable_num, variable$preF, variable$ctrF,variable$INSTNM, variable$STABBR)

#rename the categorical varaibles to approriate readable names
colnames(data_new)[35] = 'PREDDEG_factor'
colnames(data_new)[36] = 'Control_factor'
colnames(data_new)[37] = 'INSTNM_factor'
colnames(data_new)[38] = 'STABBR_factor'

#need to be commented out
mean(is.na(data_new$NPT4_PUB))
```

Considering the variable NPT4_PUB and NPT4_PRIV are mutually exclusive, to maximize the data integrity, we integrated the information of the two coloumns into a single cololumn, named with "NPT4_COMBINE". The new coloumn records the average net price for TITLE IV institutions of both public and private. 
```{r, message=FALSE,warning=FALSE}

for (i in 1:length(data_new$NPT4_PRIV)) {
   if (is.na(data_new$NPT4_PRIV[i])) {
       data_new$NPT4_PRIV[i] = data_new$NPT4_PUB[i]
   }
}
mean(is.na(data_new$NPT4_PRIV))
data_new = data_new[,-10] 
colnames(data_new)[10] <- "NPT4_COMBINE"

mean(is.na(data_new$NPT4_COMBINE))
```

In order to choose the variables that have enough valid data related to the topic, we filtered and considered variables with percent missing value less than 25%. The new data set was named as ???data_clean??? for further analysis. 
```{r, message=FALSE,warning=FALSE}

data_clean = data_new[,colMeans(is.na(data_new)) < 0.25]

#rearrange the coloumn names
data_clean = data_clean[c(1,17,18,15,16,2:14)]

write.csv(data_clean,"data_clean.csv")
```
The data_clean will be the cleaned dataset we used in the further variable summaries and comparisons


For numeric variabls, we calculate the basic summary statistics such as median, min, max, mode and quantile. We also use visualizations such as hisgroms and boxplots to understand the distribution of the values. For categorical variables, we use frequency table to understand the frequcies of each categories.Box chart is used as a visualization tool.

The table below lists the variables that will be used for the further analysis: 12 of them are continuous variables while 3 of them are categorical variables. Our data set now contains 120 rows and 15 columns. 120 rows consist of 20 years??? of data for each of the chosen six countries. The 15 columns consist of country name, country code, year, and the twelve indicators.


| Variable Name    | Data Type |  Unit  |  Description                                                          |    Category in Documentation       |
| --------------  | -----------|- ----|-----------------------------------------------------------------| --------------------------------|
| NPT4_COMBINE    | Numeric   | $         |average net price for TITLE IV institutions of both public and private.|  Cost                       |
| DEP_STAT_PCT_IND | Numeric  | $         |Percentage of students who are financially independent                |     Cost                        |
| PAR_ED_PCT_1STGEN| Numeric  | %         |Percentage first-generation students                                  |      Sudent Body                |
| MD_FAMINC        | Numeric  | $         |Median family income in real 2015 dollars                             |       Earning                   |
| PCTPELL          | Numeric  | %         |Percentage of undergraduates who receive a Pell Grant                 |        Financial Aid            |
| PCTFLOAN         | Numeric  | %         |Percent of all federal undergraduate students receiving a federal student loan      |  Financial Aid    |
| GRAD_DEBT_MDN    | Numeric  | $         |The median debt for students who have completed                       |   Financial Aid                 |
| WDRAW_DEBT_MDN   | Numeric  | $         |The median debt for sutdents who have not completed                   |Financial Aid |
| MD_EARN_WNE_P6   | Numeric  | $         |Median income six years after entry                                   |     earning   |
| MD_EARN_WNE_P10  | Numeric  | $         |Median income ten years after entry                                   |     earning  |
| RPY_3YR_RT_SUPP  | Numeric  | %         |Repayment rate 3 years after entering repayment                       |Repayment   |
| CDR3             | Numeric  | %         |Loan default rate 3 years afer entering repayment                     |Repayment        |
| PREDDEG_factor    | Factor  | N/A          |Predominant degree offered                                            |School       |
| Control_factor    | Factor  | N/A          |Control of institution                                                |School     |
| STABBR_factor  | Factor     | N/A       |State                                                                 |School     |
| APPL_SCH_PCT_GE2 | Numeric  | %         |Percentage of students submitting 2 or more than 2 applications       | Student        |
| UNITID | Numeric | N/A| Unique ID for the institutions | unknown
| INSTNM | Factor |  N/A|name for the institutions | unknown


we will summarize the data set using dplyr and ggplot funtions in the variables summary section.


#4. Objective<a id="objective"></a>
Over years, Many students see college as an investment to help them earn more and live better lives after graduation. Amount of findints have been conducted to analyze the influence of college quality on students' post graudation earning based on *colleges characterestis, student's demographic information, as well as family charateristics as well as federal finanical support to low-income students.  It has become more and more important to understand the fac- tors that contribute to post-graduation earnings and the ability to repay student loans.

Our objective in this stage is to conduct an exploration analysis on the CollegeScore dataset, investigating the individual variable's summary statistics and the relationship between these variabls, so as to better prepare for further analaysis on the factors affecting students' post college earnings with some advanced data mining techniques. 


#5. Summary of variables<a id="variablesummary"></a>
##5.1 Individual variable summary

###5.1.1 School
####5.1.1.1. State
State variable has 59 levels, which include 55 states in the United States, as well as......... From the following frequncy table, we see that California has the most University-equivalent institutions across the nation, followed by Texas and Ner York. It has about 800 universities! A bar chart is plotted below to show the top states with the most universities. Then summary of frequency table also shows that the state having the least university only has one, and 50% of state has more than 132 universities in the state.
```{r, message=FALSE}

state_freq = count(data_clean,"variable$STABBR")[order(-count(data_clean,'variable$STABBR')$freq),]
state_freq[1:15,]
summary(state_freq)
state_freq[1:15,] %>% ggplot(aes(x=factor(variable.STABBR), y=freq)) +
  geom_bar(stat = 'identity')

```

####5.1.1.2. Predominant Degree
Then we analyze the type of degree universities mainly offer. There are four types of degree taken into accout: Certificate-degree, Associate's degree, Bachelor's degree, and Graduate Degree. About 5% of the population are classified in terms of the predomiant degree they offer.  43.2% offer Certificate degree as their predominant degree, 27.3% predominantly offer Bachelor degree and only 4.23% are classified as Graduate degree predominant.

```{r, message=FALSE}
prop.table(table(data_clean$`variable$preF`)) * 100
data_clean %>% ggplot(aes(x=variable$`preF`, fill = 'blue')) + 
  geom_histogram(stat = "count") +
  xlab("Degree") 
```



####5.1.1.3. Control of Institution
In addition to State and predominant degree, control of institution is another categorical variable in the dataset. The label of Control is to indicate whether or not a institution is institution is privately owned and whether or not it is a for-profit organization. There are three levels of this variable: Public, Private Nonprofit, and Private-profit. Public school is assumed to be non-profit so it was not further divided into two subgroups. Below we show the percentage summary of each category and a bar char is plotted to facilitate understanding. About 50% out of all institution are private for-profit university, which is the *most dominant type*. Public and Private Nonprofit are pretty tie in terms of number of observation in each category.

```{r, message=FALSE}
prop.table(table(data_clean$`variable$ctrF`)) * 100
data_clean %>% ggplot(aes(x=variable$`ctrF`, fill = 'blue')) + 
  geom_histogram(stat = "count") +
  xlab("Degree")
```










###5.1.2 Student Body
####5.1.2.1 Percentage first-generation students
This element identifies the share of federally aided students at the institution who report that they are first generaion on the FAFSA (Free Application for Federal Student Aid). First generation students are defined as sudents in which neither parents completed college. 

With the followin codes, we extracted the institions with the highest and lowest percentage of first-generation students. Then we observed this varibles's basic summary statistics: min, max, mean, median and standard deviation.
```{R, message=FALSE, warinig = FALSE}

#the institions with the highest and lowest percentage of first-generation students
data_clean %>%
 slice(c(which.min(PAR_ED_PCT_1STGEN),which.max(PAR_ED_PCT_1STGEN))) %>%
  select (c(1,2,3,8))


summarize(data_clean,
          minPAR_ED_PCT_1STGEN=min(PAR_ED_PCT_1STGEN*100 ,na.rm=TRUE),
          maxPAR_ED_PCT_1STGEN=max(PAR_ED_PCT_1STGEN*100,na.rm=TRUE),
          meanPAR_ED_PCT_1STGEN=mean(PAR_ED_PCT_1STGEN*100,na.rm=TRUE),
          medianPAR_ED_PCT_1STGEN=median(PAR_ED_PCT_1STGEN*100,na.rm=TRUE),
          sdPAR_ED_PCT_1STGEN = sd(PAR_ED_PCT_1STGEN*100,na.rm=TRUE))



```
From the output, we can tell that the highest value existed in  La Belle Beauty Academy with the value of 95.25%. The lowest value is 6.87%, which existed in Wheaton College. From the mean value of 48.08%, we can tell that about for federally aided students in most colleges, around half (50.8%) of the students' parents did not complete the college. The standard deviation value of 12.2% indicated a relative high difference of this element among different colleges.  

Below is the code to generate a visual representation in the histgram. 
```{R}

 
  ggplot(data=data_clean , aes(PAR_ED_PCT_1STGEN)) + 
    geom_histogram(breaks=seq(0.1, 1, by =0.1), 
                   col="white", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for PAR_ED_PCT_1STGEN") +
    labs(x="PAR_ED_PCT_1STGEN", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, we can tell the share of first generarion students is most frequently falling into the range between 0.5 and 0.6. The value with the value more than 0.8 are rare. The colleges with the share of first generarion students value less than 0.5 are much more than the ones with the value larger than 0.5. Thus the histogram is seriously left skewed. 



####5.1.2.2 Number of applications
The variable APPL_SCH_PCT_GE2 is to describe the percentage of students who list two and more than two institutions when he apply for financial aid when apply for universities. This information is only available to students who submit their applications for federal aid, and not cover the whole student body. Nevertheless, this variable still can provides some useful insights about how many universities a student usually apply to. 

The summry statistics show that median percentage of student submitting two or more than two application is 41.67 across all univerisities. The institution having the least percentage only has 4% of student applying to more than one university, while the school with the highest percent has as high as 90% of student applying to more than one university. The boxplot compare the the percent of student applying to only one university and that of student applying to more than 1. We can clearly see that a larger portion of students only list one instituiton when submitting their application for financial aid.


```{r, message=FALSE}
college_app_2_clean = data_clean$APPL_SCH_PCT_GE2[!is.na(data_clean$APPL_SCH_PCT_GE2)]*100
summary(college_app_2_clean)

college_app_2_clean %>% as.data.frame() %>%
    mutate(college_app_1 = 100-college_app_2_clean)%>%
    {.}  -> college_app
colnames(college_app)[1] <- "two_or_greater"

college_app %>% gather(key = num_app, value = perc_student) %>%
{.} -> college_app

college_app %>%
    ggplot(aes(factor(num_app), perc_student)) +
    geom_boxplot() 
```




###5.1.3 Cost
####5.1.3.1 Average net price for Title IV institutions(both public and private institutions)

With the followin codes, we extracted the IV institutions with the highest and lowest Average net price. Then we observed this varibles's basic summary statistics: min, max, mean, median and standard deviation.
 
```{R, message=FALSE, warinig = FALSE}

data_clean %>%
 slice(c(which.min(NPT4_COMBINE),which.max(NPT4_COMBINE))) %>%
  select (c(1,2,3,6))

summarize(data_clean,
          minNPT4_COMBINE=min(NPT4_COMBINE ,na.rm=TRUE),
          maxNPT4_COMBINE=max(NPT4_COMBINE,na.rm=TRUE),
          meanNPT4_COMBINE=mean(NPT4_COMBINE,na.rm=TRUE),
          medianNPT4_COMBINE=median(NPT4_COMBINE,na.rm=TRUE),
          sdNPT4_COMBINE = sd(NPT4_COMBINE,na.rm=TRUE))



```
From the summary results, we learned that the maximum value of the variable is $87,414, which is for Aerosim Flight Academy located in FL. while the minimum value is about $-19,360 - the value for Berea College located in KY. Considering the elements are collected from Title IV institutions, we reasoned that the negative values may be due to the fact that some intituions's finainal aid supoort can cover the students' all the costs, meanwhile overbalancing the cost amount. There are not much differerences between mean value and median value, which is around $15,000. We can conclude that the average net price costs for most institutuins are falling into the this range. The standard deviation value is 7604.884 which is relatively large, indicating a great spread in the data. 


Below is the histogram for this variable which is able to provide us with a visual distrubution presentation. 
```{R}

  #histogram for NPT_COM
  ggplot(data=data_clean , aes(NPT4_COMBINE)) + 
    geom_histogram(breaks=seq(0, 90000, by =2000), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for NPT_COM") +
    labs(x="NPT_COM", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, we notice that the average net cost for IV institutions typically is 16000 -18000. The values between 16000 - 20000 are quite frequent. There were an unsually lagrge number of costs. The institutions with cost of more than 50000 were atypical. Due to the atypical large value, the histogram is abviously right skewed. Without those extreme values, the histogram would be reasonably symmetric. 




####5.1.3.2 Percentage of students who are financially independent

With the followin codes, we extracted the institions which have the highest and lowest percentage of students who are financially independent. Then we observed this varibles's basic summary statistics: min, max, mean, median and standard deviation.
```{R}

data_clean %>%
 slice(c(which.min(DEP_STAT_PCT_IND),which.max(DEP_STAT_PCT_IND))) %>%
  select (c(1,2,3,7))

summarize(data_clean,
          minDEP_STAT_PCT_IND=min(DEP_STAT_PCT_IND*100 ,na.rm=TRUE),
          maxDEP_STAT_PCT_IND=max(DEP_STAT_PCT_IND*100,na.rm=TRUE),
          meanDEP_STAT_PCT_IND=mean(DEP_STAT_PCT_IND*100,na.rm=TRUE),
          medianDEP_STAT_PCT_IND=median(DEP_STAT_PCT_IND*100,na.rm=TRUE),
          sdDEP_STAT_PCT_IND = sd(DEP_STAT_PCT_IND*100,na.rm=TRUE))



```
From the summary results, we learned that the maximum value of the variable is 98.56%(Capella University) while the minimum value is about 0.73%(University of Notre Dame). From the mean value, we can tell that about in most colleges, around 56% of the students are financially independent. The standatd deviation value of 23.3% indicates a relative high different among different colleges, which can also be concluded from the difference between maximum value and minimum value. Below is the code to generate a visual representation in the histgram.

```{R}

  #histogram for NPT_COM
  ggplot(data=data_clean , aes(DEP_STAT_PCT_IND)) + 
    geom_histogram(breaks=seq(0.1, 1, by =0.1), 
                   col="white", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for DEP_STAT_PCT_IND") +
    labs(x="DEP_STAT_PCT_IND", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, we notice that the value between 0.7 to 0.8 are quite frequent. There was no obvious extrme value in the sample, thus the histogram is normally distributed. 




###5.1.4 Financial Aid 
####5.1.4.1 Percentage of undergraduates who receive a Pell Grant

This elemnt, pulled from the IPEDS student Financial Aid Component, shows the share of undergraduate students who received Pell Grants in a given year, which is an important measure of the access an insiitution provides to low-income students. 

We are using the code below to summarize this variable and extraced the instition with the highest and lowest value. 

```{R, message=FALSE, warinig = FALSE}

data_clean %>%
 slice(c(which.min(PCTPELL),which.max(PCTPELL))) %>%
  select (c(1,2,3,10))

summarize(data_clean,
          minPCTPELL=min(PCTPELL*100 ,na.rm=TRUE),
          maxPCTPELL=max(PCTPELL*100,na.rm=TRUE),
          meanPCTPELL=mean(PCTPELL*100,na.rm=TRUE),
          medianPCTPELL=median(PCTPELL*100,na.rm=TRUE),
          sdPCTPELL = sd(PCTPELL*100,na.rm=TRUE))



```
From the output, we can tell that the range is between 0 to 100%.	No students in Thunderbird School of Global Management has received the Pell grant while all of the students in American Conservatory Theater have receiced the Pell Grant. Among the colleges in the sample, half colleges have this rate as high as 52.7% (median value of 52.7%), which means more than half of undergraduare students are able to receive the Pell Grant to cover their costs. The standard deviation value is 22.57%,  indicating a relative high difference of this element among different colleges, which can also be noticed from the largest range (100%). Below is the code to generate a visual representation in the histgram. 
   
```{R}

 
  ggplot(data=data_clean , aes(PCTPELL)) + 
    geom_histogram(breaks=seq(0, 1, by =0.1), 
                   col="white", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for PCTPELL") +
    labs(x="PCTPELL", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, we are able to conclude that in most colleges, 40% to 50% of the undergraduate students are able to receive the Pell Grant. With little skewness, the histogram is resonalbe symmetric. 




####5.1.4.2 Percent of all federal undergraduate students receiving a federal student loan

This elemnt, as reported in the IPEDs Student Finaicial Aid component, show the share of undergraduate students who received federal loans in a given year. It can provide important context to figures related to debt, repayment and non-repayment.  
We are using the code below to summarize this variable and extracted the institutions with highest and lowest value. 

```{R, message=FALSE, warinig = FALSE}

data_clean %>%
 slice(c(which.min(PCTFLOAN),which.max(PCTFLOAN))) %>%
  select (c(1,2,3,11))

summarize(data_clean,
          minPCTFLOAN=min(PCTFLOAN*100 ,na.rm=TRUE),
          maxPCTFLOAN=max(PCTFLOAN*100,na.rm=TRUE),
          meanPCTFLOAN=mean(PCTFLOAN*100,na.rm=TRUE),
          medianPCTFLOAN=median(PCTFLOAN*100,na.rm=TRUE),
          sdPCTFLOAN = sd(PCTFLOAN*100,na.rm=TRUE))



```
From the output, we can tell that the range is between 0 to 100%.	As we can recall from the previous variable(PCTPELL), American Conservatory Theater has both the PCTLOAN and PCTPELL the value of 100%. Gadsden State Community College has no students reveiced federal loans in the given year. Among the colleges in the sample, half colleges have this rate as high as 60.08% , which means around 60% of undergraduare students are able to receive the fedaral student loans. The standard deviation value is 29.26%,  indicating a relative high difference of this element among different colleges, which can also be noticed from the largest range (100%). Below is the code to generate a visual representation in the histgram. 

```{R}

 
  ggplot(data=data_clean , aes(PCTFLOAN)) + 
    geom_histogram(breaks=seq(0, 1, by =0.1), 
                   col="white", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for PCTFLOAN") +
    labs(x="PCTFLOAN", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, it's obvious that there are two peaks in the graph. The rates between 0- 10% and the rates between 60% to 80% are similarly frequent compated to the other ranges.  
 



####5.1.4.3 The median debt for students who have completed

This element is the median loan debt acculated at the institution by all student borrowers of federal lonans who have habe completed the education. We are using the code below to summarize this variable. 
```{R, message=FALSE, warinig = FALSE}

data_clean %>%
 slice(c(which.min(GRAD_DEBT_MDN),which.max(GRAD_DEBT_MDN))) %>%
  select (c(1,2,3,12))

summarize(data_clean,
          minGRAD_DEBT_MDN=min(GRAD_DEBT_MDN ,na.rm=TRUE),
          maxGRAD_DEBT_MDN=max(GRAD_DEBT_MDN,na.rm=TRUE),
          meanGRAD_DEBT_MDN=mean(GRAD_DEBT_MDN,na.rm=TRUE),
          medianGRAD_DEBT_MDN=median(GRAD_DEBT_MDN,na.rm=TRUE),
          sdGRAD_DEBT_MDN = sd(GRAD_DEBT_MDN,na.rm=TRUE))


```
From the output, we can tell that the highest value is 48,250 - Southwest University of Visual Arts-Tucson, while the lowest value is 1448 - South Florida Institute of Technology. From the median value of 14000, we can tell that among the colleges in the sample, the students who have completed the deducaiton from half of them had the median loan debt of 14000. The standard deviation value is 8020.958,  indicating a relative high difference of this element among different colleges. Below is the code to generate a visual representation in the histgram. 

```{r}

 ggplot(data=data_clean , aes(GRAD_DEBT_MDN)) + 
    geom_histogram(breaks=seq(0, 50000, by =2000), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for GRAD_DEBT_MDN") +
    labs(x="GRAD_DEBT_MDN", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))


```
From the histogram, it is obvious that most students in the sampled colleges still have 8000- 10000 debt amount after they completed the education. This amount is related to the federal loan amount provided by each institution. Additionally, it is asscociated with students' ability to repay the loan during the acdemic period. For example, for the students who were capabiblity of working through the acedemic years or securing jobs before graduation may have a less value for this variable. 







####5.1.4.4 The median debt for students who have not completed<a id="5.1.4.4"></a>
WDRAW_DEBT_MDN describe the median number of debt fot students who ahve not completed their study. In other words, they are still attending the university. The summary statistics show that student in 50% of institution have a median debt of 5500.The median debt for attending students can be as much as 27620 for some school and as low as 600 for other. So we also calculate standard deviation to measure the dispenser of the distribution. The standard deviation is 2415.623 about 95% of institution have a median debt ranging from 1167.754  to 10830.246. The histogram that the distribution of the median roughly follows a standard distribution with a sharp peak and slightly heavy tail.
```{r, message=FALSE}
median_debt_non_null = data_clean$WDRAW_DEBT_MDN[!is.na(data_clean$WDRAW_DEBT_MDN)]
summary(median_debt_non_null)
sd(median_debt_non_null)

#plot a ggplot to better illustrate
data_clean %>% ggplot(aes(x = WDRAW_DEBT_MDN)) +
                geom_histogram(binwidth = 450) #warning?

ggplot(data=data_clean,
       aes(x=WDRAW_DEBT_MDN,
           fill = I('red'))) +
    geom_density(alpha=0.5) +
    scale_x_continuous("Median Debt for Students Who Have Completed")

```







###5.1.5 Earning
####5.1.5.1 Median family income in real 2015 dollars<a id="5.1.5.1"></a>
This elemnt is recording the median family income of students, one of the undergraduate student demographics for earnings cohorts. 

We are using the code below to summarize this variable. 

```{R, message=FALSE, warinig = FALSE}

data_clean %>%
 slice(c(which.min(MD_FAMINC),which.max(MD_FAMINC))) %>%
  select (c(1,2,3,9))

summarize(data_clean,
          minMD_FAMINC=min(MD_FAMINC ,na.rm=TRUE),
          maxMD_FAMINC=max(MD_FAMINC,na.rm=TRUE),
          meanMD_FAMINC=mean(MD_FAMINC,na.rm=TRUE),
          medianMD_FAMINC=median(MD_FAMINC,na.rm=TRUE),
          sdMD_FAMINC = sd(MD_FAMINC,na.rm=TRUE))



```
From the output, we can tell that the highest value is 155,606.6 -Jewish Theological Seminary of America, while the lowest value is 0 -Associated Technical College-Los Angeles. From the median value of 19,262.26, we can tell that among the colleges in the sample, the students in half of them had the family income below 19,262.26	. The standard deviation value is 18,824.31,  indicating a relative high difference of this element among different colleges. Below is the code to generate a visual representation in the histgram. 

```{R}

 
  ggplot(data=data_clean , aes(MD_FAMINC)) + 
    geom_histogram(breaks=seq(0, 156000, by =3000), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for MD_FAMINC") +
    labs(x="MD_FAMINC", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```
From the histogram, we are able to conclude that in most colleges, students' family income are falling into the range of 12,000 - 18,000. Due to the atypical large values, the histogram is obviouslu skewed to right. The value larger than 18,000 are tend to be extreme and the cases larger than 75000 are rare and atypical, which means rare colleges have the students with family income more than 75000.




####5.1.5.2 Earning after graduation
We selected two variables MD_EARN_WNE_P6, MD_EARN_WNE_P10 in the earning group to study students' post-graduation earning. MD_EARN_WNE_P6 is the median earning for students six years after their entry, which corresponds to two years after gradutaion. Likewise, MD_EARN_WNE_P10 is the median earning ten years after their entry, which corresponds to four years after graduation. These two metrics give us an idea of how much money students are making after their graduation, in both short and medium terms,

In addition to these two variables, a derived variable is also calculated as the difference between the salary 2 years post-graduation and another two years later. The median earning of 50% institutions is below the 25300 below, while the maximum median earining is 120200. After two years, the median earning increase by about $5500. The histogram gives a more clear idea of the earning distribution. Most of institution with students having a median earining between 10000 to 50000 two years after graduation. The distribution of earining 4 years after graduation falls at the right of the distribution of 2 years post-graduation, which means that the earning increases as students' experience increase. Beside, the fout-year post-graduation earning has a wider spread than that of two years. That indicate that the there is a greater gap between who are earning more and who are earning less, which can be confirmed by the increase in standard deviation.

```{r,message=FALSE}
earning = select(data_clean, MD_EARN_WNE_P6, MD_EARN_WNE_P10 )
earning_clean = na.omit(earning)
earning_clean %>%
    mutate(salary_increase = MD_EARN_WNE_P10-MD_EARN_WNE_P6) %>%
    {.} -> earning_clean
summary(earning_clean)
apply(earning_clean, 2, sd) #dispersion increases

earning_clean %>% gather(key = years_from_entry, value = salary) %>%
    {.} -> earning_clean1

earning_clean1[earning_clean1$years_from_entry != 'salary_increase',] %>% 
    ggplot(aes(x = salary, fill =years_from_entry )) +
    geom_density(alpha = 0.5) + 
    xlim(0, 150000)


```
    


###5.1.6 Repayment 
####5.1.6.1 3-year Repayment rate
The variable RPY_3YR_RT_SUPP measure the percentage of student who entered repayemtn from October 1, 2010 to September 30, 2011, and made progress in the following three years. Repayment rates are generally considered most sensitive than default rates(we study later), which measure only the worse-case scenario for repayment outcomes. From the summary statistics, we see that 50% institutions have 40% of students who are making progress in their repayment. A histogram is also plotted to show the distribution, clearly with a heavy tail. 

```{r,message=FALSE}
repayment_clean = na.omit(data_clean$RPY_3YR_RT_SUPP)
summary(repayment_clean)
qplot(repayment_clean, geom = "histogram")
```



####5.1.6.2 3-year Default rate
The three-year cohort default rate describe the repayment in the opposite of repayment rate. In this dataset, it was calculated using the cohort of borrowers who entered repayment on their federal student loans between Octorber 1, 2010 to September 30, 2011, and who defaulted before September 2012. The median default rate aross all universities is 13%, which means that 50% of universities have 13 out of 100 students defaulted their loan! 

```{r,message=FALSE}
default_clean = na.omit(data_clean$CDR3)
summary(default_clean)
qplot(default_clean, geom = "histogram")

summary(data_clean$RPY_3YR_RT_SUPP + data_clean$CDR3)
```









#6. Relationship between variables<a id="6"></a>

##6.1. The relationship between NPT4_COMBINE and State<a id="6.1"></a>

To analyze the relationship between average net cost for Title IV institutions and State, we grouped the data into the state level to take a further look. We would like to investigate the state distribution of the Title IV instituions based on the average net costs.   
```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(variable$STABBR) %>%
    dplyr::summarise(minNPT4_COMBINE=min(NPT4_COMBINE ,na.rm=TRUE),    
    maxNPT4_COMBINE=max(NPT4_COMBINE,na.rm=TRUE),medianNPT4_COMBINE=median(NPT4_COMBINE,na.rm=TRUE))  %>%
       arrange(desc(medianNPT4_COMBINE))   %>%
{.}  ->NPT4_STATE

NPT4_STATE

```
Baesd on the output, we can see the highest median value for avreage net price exists in DC while the lowest median value is in AS(American Samoa).Moreover, we found that the top 5 states are DC, VT, MA, NH, RI, which are all states conceiving amount of well-known educational institutions. 




##6.2. The relationship between Debt and Cost<a id="6.2"></a>
We assume there would be a strong linear relationship between the average net price for Title IV institutions and the median debt for students who have completed. We hypothese that the students who completed education in colleges with high costs will have a highe value of median debt. We use the following code to generate the scatterplot between these two variables to verify our assumptions. 

```{R}


ggplot(data_clean, aes(x =NPT4_COMBINE, y = GRAD_DEBT_MDN)) + geom_point(color="red")+  geom_smooth(method = "lm", se = TRUE)+
  labs(title="Scatterplot between Cost and Debt ") +
    theme(plot.title = element_text(hjust = 0.5))
      

  
```
  
From the scatter plot, it is obvious that the NPT4_COMBINE is in positive linear relationship with GRAD_DEBT_MDN: the data show an uphill pattern from left to right; As the average net price for Title IV institutions increase, the value of median debt for students who have completed increases as well. 




##6.3. The relationship between Percentage of Pell Grant and college type(CONTROL)<a id="6.3"></a>

To compare the percentages of Pell Grant in different control type, we grouped the Percentage of Pell Grant data into the college type level to take a further analysis. We would like to investigate the percentage of Pell Grant based on the  college type. 

```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(variable$ctrF ) %>%
    dplyr::summarise(minPCTPELL=min(PCTPELL ,na.rm=TRUE),    
    maxPCTPELL=max(PCTPELL,na.rm=TRUE),medianPCTPELL=median(PCTPELL,na.rm=TRUE))  %>%
       arrange(medianPCTPELL)   %>%
{.}  ->PCTPELL_CONTROL
PCTPELL_CONTROL

```
From the result, the Private Nonprofit institutions and Public institutions have a similar low median values while the provate For- profit institutions have a hgihest value. This is resonable because generally speanking, the private for-profit colleges may have much higher costs than the private nonprofit and public institutions. The low-income students were more likely to seek a Pell Grant for assistant. Additionally, in some states, state financial aid may be sufficient to cover costs at community colleges; thus the students in thoes schools may not need to seek for addtional financial aid like Pell Grant.


```{r}

ggplot(data_clean, aes(x=PCTPELL, fill=variable$ctrF)) + geom_histogram(alpha=0.9, position="identity") +
  labs(title="Overlaying histogram between PCTPELL and Control ") +
    theme(plot.title = element_text(hjust = 0.5))


```
From the overlaying histograms, the percentage of students who receive Pell Grant are quite frequent for Private For-profit institutions between 0.7 and 0.75 ; the percentage of students who receive Pell Grant are quite frequent around 0.4 for Public institutions and Private Nonprofit institutions. The histogram for private for profit is slightly left skewed due to atypical small value near 0. The histogram for public and private nonprofit institions are reasonably symmetric


##6.4. The relationship between Percentage first-generation students and States<a id="6.4"></a>
To compare the Percentage first-generation students with the different states, we grouped data into the state level to take a further analysis.We would like to investigate the percentage of first-generation students based on the status distribution. 

```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(variable$STABBR ) %>%
    dplyr::summarise(minPAR_ED_PCT_1STGEN=min(PAR_ED_PCT_1STGEN ,na.rm=TRUE),    
    maxPAR_ED_PCT_1STGEN=max(PAR_ED_PCT_1STGEN,na.rm=TRUE),medianPAR_ED_PCT_1STGEN=median(PAR_ED_PCT_1STGEN,na.rm=TRUE))  %>%
       arrange(medianPAR_ED_PCT_1STGEN)   %>%
{.}  ->PAR_ED_PCT_1STGEN_STATE

PAR_ED_PCT_1STGEN_STATE

```

The results showed that the universities located in ND, SD, VT, MN and MT had the lowest value of Percentage first-generation students, which indicated that the students in thoses five states would have a better family education background. The five states with the highest share of parents first-generation are LA, NJ, MP, MV, MH. 



##6.5. The relationship between family income and percentage of Pell Grant<a id="6.5"></a>
 We assume there would be a strong linear relationship between family income and the percentage of students who can receive the Pell Grant. We hypothese that colleges with small value of family income would tend to have high percentages of Pell Grant. The following codes are used to generate the scatter pkot between these two varaibles. 

```{r}

ggplot(data_clean, aes(x =MD_FAMINC, y = PCTPELL)) + geom_point(color="red")+  geom_smooth(method = "lm", se = TRUE)+
  labs(title="Scatterplot between MD_FAMINC and PCTPELL ") +
    theme(plot.title = element_text(hjust = 0.5))
      
```
From the scatter plot, it is obvious that the MD_FAMINC is in a negative linear relationship with PCTPELL: the data show a downhill pattern from left to right; As the MD_FAMINC increase, the value of PCTPELL decreases. It makes sense in the real world applcation: for institutions with low percentage of students who receive the Pell Grant, the financial aids like Pell Grant may not be as necessary as they are in the instituions with high value of PCTPELL, thus these collges students will tend to have a high median family income after they graduate. 






##6.6. The relationship between DEP_STAT_PCT_IND and Control<a id="6.6"></a>


To compare the percentage of financially-independent students in institutions with different college type, we grouped by the data into the control type(Private For-profit, Public, Private Nonprofit) to take a further analysis.
```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(variable$ctrF) %>%
    dplyr::summarise(minDEP_STAT_PCT_IND=min(DEP_STAT_PCT_IND ,na.rm=TRUE),    
    maxDEP_STAT_PCT_IND=max(DEP_STAT_PCT_IND,na.rm=TRUE),medianDEP_STAT_PCT_IND=median(DEP_STAT_PCT_IND,na.rm=TRUE))  %>%
       arrange(desc(medianDEP_STAT_PCT_IND))   %>%
{.}  ->DEP_STAT_PCT_IND_CONTROL

DEP_STAT_PCT_IND_CONTROL

```
From the result, we can tell the highest median value is in Privately For-profit colleges, which means that in most private for-profit colleges, the students are more likely to be financial independent. 

##6.7. The relationship between PCTLOAN and Control.<a id="6.7"></a> 


To compare the percentage of students who receive the federal loans in the given year based on the schools control type,we grouped by the data into the control type(Private For-profit, Public, Private Nonprofit) to take a further analysis. A stacked histogram is also requested to generate a more vidual presentation. 

```{R message=FALSE, warinig = FALSE}


data_clean %>%
  group_by(variable$ctrF ) %>%
    dplyr::summarise(minPCTFLOAN=min(PCTFLOAN ,na.rm=TRUE),    
    maxPCTFLOAN=max(PCTFLOAN,na.rm=TRUE),medianPCTFLOAN=median(PCTFLOAN,na.rm=TRUE))  %>%
       arrange(medianPCTFLOAN)   %>%
{.}  ->PCTFLOAN_CONTROL

PCTFLOAN_CONTROL


#stacked histogram
data_clean %>%
  ggplot(aes(x=PCTFLOAN)) +
  geom_bar(binwidth=0.1,aes(fill=Control_factor ))



```

From the result, the Private institutions have a much larger median value than the public institutions. With a much higher costs burden, it makes sence that the low-income sutdents in private institutions are much more likely to seek financial aid than the public institution students. 
From the stacked histogram, we can tell that for all the three college type institutions, the most frequent ranges appear between 0.6 and 0.8, which is consistent with the findings we observe in the individual variable summary section. 



##6.8 cost and median debts with earning
Next, we analyze the relationship between the amount the debt and post-graduation earning. There are variable in the dataset to summarize the median amount for student body, one for students who already graduated and one for students who have not completed their study. We decide debts for students who have not completed to study in this problem, since it may can be used as a predictor in the future modeling. First, we use scatter plot to visualize the relationship between earning and the amount of debts, the plot clearly shows a positive relationship. Then we further calculate pearson correlation to confirm our hypothesis. The resulting coefficient 0.44 indicatesa moderate linear relationship between earning and debts. 

```{r, message=FALSE}


data_clean %>% ggplot(aes(x = WDRAW_DEBT_MDN, y = MD_EARN_WNE_P6)) + 
                geom_jitter() +
                geom_smooth(method = "lm", se = FALSE, col = 'red')

data_clean %>% select(WDRAW_DEBT_MDN, MD_EARN_WNE_P6) %>%
      na.omit() %>%
       {.} -> earn_debt

cor(earn_debt$WDRAW_DEBT_MDN,earn_debt$MD_EARN_WNE_P6)


```


##6.9 default with earning

Understanding the relationship between the default rate of load repayment and post-graduation earning on one hand can help federal financial commitee to improve their decision about load granting. If the the default rate increases as the earning increase, the commitee may prefer to grant more financial aid to institution whose students have higher earning. One the other hand, the default rate of repayment for a univeristy can also help predict the post-graduation earning for its students. A scatter plot is created to visualized the relationship between these two variables. From the chart, we see the earning seem to show a decreasing trend as the default rate increases, which shows a negative relationship between earning and default rate. Then we create the correlation coefficient of these two variables. The resulting r = -0.33 shows that correlation between earning and default rate is negative but the relationship is not very strong, this may be due the influences of some outliers. To conclude, the negative relationship between earning and default rate of loan repayment needs larger population or detail data processing to confirm.


```{r, message=FALSE}
data_clean %>% ggplot(aes(x = CDR3, y = MD_EARN_WNE_P6)) + 
                geom_jitter() +
                geom_smooth(method = "lm", se = FALSE, col = 'red')

data_clean %>% select(CDR3, MD_EARN_WNE_P6) %>%
      na.omit() %>%
       {.} -> earn_default

cor(earn_default$CDR3,earn_default$MD_EARN_WNE_P6)

```

##6.10 degree type vs. earning

The higher education one receives, the higher the earning is after graduation. This is an assumption we are making when investing higher education. But is it really the case. In this question, we would like to study if it's worthwhile to invest in higher degree. From the boxplot below, we see that the higher the education, the higher the median earning 2 years after graduation. Especially, a graduate-degree give a hugh rise to one's earning.


```{r, message=FALSE}

data_clean %>%
  ggplot(aes(x=`variable$preF`,
             y=MD_EARN_WNE_P6)) +
  geom_boxplot(aes(fill = `variable$preF`))




```



##6.11 predominant degree, control  and earning after 6 year of entry
The following plot shows two factor variables (predominant degree award variable and control variable) associated with one numeric variable (MD_EARN_WNE_P6: Median earnings of students working and not enrolled 6 years after entry. Our team uses the function geom_tile()[ggplot2 package] to visualize the correlation matrix.

```{r}
 data_clean %>%
 group_by(preF, ctrF) %>%
summarize(avg.earn_p6=mean(MD_EARN_WNE_P6)) %>%
 ggplot(aes(x=ctrF, y=preF)) +
  geom_tile(aes(fill=avg.earn_p6))

```
Mean value of the earning is more representative for the two categories, preF and ctrF. For the range of average earning, the darkest color shows the lowest earning, while the lightest color shows the highest value. According to the plot, we realize that ???Private For-profit college??? whose predominant degree award is ???Graduate degree??? has the lowest average earning with the minimum average value at \$3100, while ???Public college??? whose predominant degree award is ???Graduate degree??? has the highest average earning with the maximum average value at $45850.


##6.12 predominant degree + control (count)
The following plot shows the relationship between two factor variables (predominant degree award variable and control variable). Our team uses the function geom_bar() to map the counting values to y, ctrF variable to x and the preF variable to the fill of the bar.


```{R}
data_clean %>%
+ ggplot(aes(x=ctrF))+
+ geom_bar(aes(fill=preF), position = 'dodge')
```
According to the histogram comparison of predominant degree award among three types of colleges, we realize that for public college, Associate???s-degree is most frequent awarded in the public colleges. Bachelor???s-degree is most frequent awarded in the private nonprofit colleges. Certificate-degree is most frequent awarded in private for-profit colleges.

Although the ???Graduate-degree??? awarded by public colleges shows the least frequency, it gains the highest average earnings of students working and not enrolled 6 years after entry compared with other degrees awarded by different colleges.

Our team further uses the function xtabs() to calculate the exact number for each predominant degree awarded by different types of colleges.
```{R}
 data_clean %>%
 xtabs(formula = ~preF+ctrF)
```


 #6.11 control + earning
The following plot shows one factor variable (control variable) associated with one numeric variable (MD_EARN_WNE_P6: Median earnings of students working and not enrolled 6 years after entry). We use the 
geom_violin() using the default scale = ???area??? argument and geom_boxplot() function to explore the relationship. The plot superimposed with boxplots shows side-by-side violin plots of median earnings of students working and not enrolled 6 years after entry according to different college types.

```{r}
 data_clean %>%
+ ggplot(aes(x=ctrF, y=MD_EARN_WNE_P6)) +
+ geom_violin(aes(fill=ctrF), scale = 'area') +
+ geom_boxplot(aes(fill=ctrF), width = 0.25, outlier.size = 1.25)
```
Obvious differences contain in these three boxplots. The boxplot of ???Public college??? is comparatively short, while the boxplot of ???Private Nonprofit??? is comparatively tall. The ???Private For-profit college??? has the lowest median earning.



#7. Findings and Conclusion 
    



