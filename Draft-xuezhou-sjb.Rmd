---
title: "Exploratory Data Analysis for College Scorecard Dataset"
author: "Kun Shen, Xiang Li, Xue Zhou"
date: "February 20, 2017"
output: html_document
---

```{r setup, include=FALSE,warning=FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE,warning=FALSE,message = FALSE)
```

#Table of Contents
* 1.[Introduction](#Introduction)
* 2.[Goal](#Goal)
* 3.[Dataset Preparation](#dataprep)
* 4.[Objective](#objective)
* 5.[Summary of Variables](#variablesummary)
* 5.1 [Individual Variable Summary](#5.1)
  * 5.1.1 [School](#5.1.1)
    * 5.1.1.1 [State](#5.1.1.1)
    * 5.1.1.2 [Predominant Degree](#5.1.1.2)
    * 5.1.1.3 [Control of Institution](#5.1.1.3)
  * 5.1.2 Student Body
    * 5.1.2.1 [Percentage First-generation Students](#5.1.2.1)
    * 5.1.2.2 [Number of Applications](#5.1.2.2)
  * 5.1.3 Cost 
    * 5.1.3.1 [Average Net Price for Title IV Institutions (Both Public and Private Institutions)](#5.1.3.1)
    * 5.1.3.2 [Percentage of Students Who are Financially Independent](#5.1.3.2)
  * 5.1.4 Financial Aid
    * 5.1.4.1 [Percentage of Undergraduates Who Receive a Pell Grant](#5.1.4.1)
    * 5.1.4.2 [Percent of all Federal Undergraduate Students Receiving a Federal Student Loan](#5.1.4.2l)
    * 5.1.4.3 [The Median Debt for Students Who Have Completed](#5.1.4.3)
    * 5.1.4.4 [The Median Debt for Students Who Have not Completed](#5.1.4.4)
  * 5.1.5 Earning
    * 5.1.5.1 [Median Family Income in real 2015 Dollars](#5.1.5.1)
    * 5.1.5.2 [Earning after graduation](#5.1.5.2)
  * 5.1.6 Repayment
    * 5.1.6.1 [3-year Repayment rate](#5.1.6.1)
    * 5.1.6.2 [3-year Default rate](#5.1.6.2)
* 6.Relationship between variables
 * 6.1 [The Relationship between NPT4_COMBINE and State](#6.1)
 * 6.2 [The Relationship between Debt and Cost](#6.2)
 * 6.3 [The Relationship between Percentage of Pell Grant and College Type (CONTROL)](#6.3)
 * 6.4 [The Relationship between Percentage First-generation Students and States](#6.4)
 * 6.5 [The Relationship between Median Family Income and Percentage of Pell Grant](#6.5)
 * 6.6 [The Relationship between the Percentage of Financially-independent Students and College Type (Control)](#6.6)
 * 6.7 [The Relationship between Percentage of Students Who Receive the Federal Loans and College Type (Control).](#6.7)
 * 6.8 [The Relationsip between Median Debts and Post-Graduation Earnings](#6.8)
 * 6.9 [The Relashionship between the Default Rate of Loan Repayment and Post-graduation Earnings ](#6.9)
 * 6.10 [The Relashionship between Earning 6 Years from Entry and Degree Type](#6.10)
 * 6.11 [The Relashionship among Predominant Degree, College Type(Control) and Earning after 6 year of Entry](#6.11)
 * 6.12 [The Relashionship between Predominant Degree and College Type (Control)](#6.12)
 * 6.13 [The Relashionship between College Type (Control) and Median earnings of Students Working and Not Enrolled 6 Years after Entry](#6.13)
* 7. [Findings and Conclusion](#7)
       

#1. Introduction<a id="Introduction"></a>
The College Scorecard project was initially designed to increase the transparency of the college data, working as a navigator for students to make informed decisions about their choice for higher education. The information gathered in the dataset also gives students and families more power to differentiate postsecondary institutions and get an idea about how well colleges are preparing their students to be successful. The dataset was created to address the lack of information about college costs, earnings, federal student aid, admission rate, etc. The data provides insights into the performance of institutions that receive federal aid dollars, and the outcomes of the students of those institutions. It also gives extra support for students and families to weigh the tradeoffs on choosing the right colleges according to their own needs and educational goals.

The data was collected by the United States Department of Education, which corresponds to all undergraduate degree-granting institutions of higher education from 1996 through 2016. The dataset is pretty rich and covering a wide range of topics. It has 1743 associated columns, each corresponds to one named data variable. All data variables are divided into 10 categories ranging from Root category to Earnings category. The data type contains integer, string and float. Data elements with an IPEDS value in the Source field are derived directly from the Integrated Postsecondary Education Data System (IPEDS). Further detailed description of the dataset can be found in the CollegeScorecardDataDictionary.xlsx excel file.



#2. Goal<a id="Goal"></a>

College is an investment. It's well-known that a major motivation for students to attend a university is higher post-graduation earnings. So will your school make sure you get a return? With college costs and student-debt levels reaching an all-time high, it's important to know which schools produce the highest earning alumni and what factors can help us predict post-graduation earnings for students in a university.

The goal of our study is to understand what factors are predictive of students' post-graduation earnings through individual variable analysis and relationship detection. To this end, we first explored a set of variables that were carefully selected to represent a school's profile and students demographic information, getting to know the distribution of each variable. Then we further analyzed how these variables are related, particually the relationship between earnings and other variables.

#3. Dataset Preparation<a id="dataprep"></a>
Our analysis focuses on the data of year 2012 -2013 of 38 variables. We chose the median income 6 years after entry as our predictor variable, and eliminated many fields with a bunch of missing values as well as some fields not pertaining enougn to post-graduation income. We then fosued primarily on a set of 23 variables, including age, acedemic costs, family income, completetion rates and repayment rate.  


The following libraries have been used in the analysis: 
```{r, message=FALSE,warning=FALSE}

library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(ggvis)
library(plyr)

```

The dataset spans nearly 20 years of data and covers multiple sources including IPEDS, NSLDS, and Department of Treasury. Since our goal was to study post-graduation for students in each university, we used 2012-2013 dataset which contains tha most recent earning information.

```{r, message=FALSE,warning=FALSE}

data = read.csv("MERGED2012_13_PP.csv",header = T, na.strings = c("NULL","PrivacySuppressed"))

```

Considering there is some special characters in the ID column, we first renamed the first column to make it easier to understand.
```{R}
colnames(data)[1] = 'UNITID'
```

The full dataset contains 1743 variables, as we metioned before, 38 variables were intially selected to be analyze.
```{r, message=FALSE,warning=FALSE}

variable = select(data, UNITID, INSTNM, STABBR, PREDDEG, LOCALE2, MENONLY, WOMENONLY, CONTROL, ADM_RATE, SATMTMID, SATVRMID, SATWRMID, SAT_AVG,
                  NPT4_PUB,
                  NPT4_PRIV,
                  UG,
                  UG_NRA,
                  UG_UNKN,
                  UG_WHITENH,
                  UG_BLACKNH,
                  UG_API,
                  UG_AIANOLD,
                  UG_HISPOLD,
                  DEP_STAT_PCT_IND,
                  PAR_ED_PCT_1STGEN,
                  MD_FAMINC,
                  MEDIAN_HH_INC,
                  POVERTY_RATE,
                  PCTPELL,
                  PCTFLOAN,
                  GRAD_DEBT_MDN,
                  WDRAW_DEBT_MDN,
                  APPL_SCH_PCT_GE2,
                  C150_4,
                  MD_EARN_WNE_P6,
                  MD_EARN_WNE_P10,
                  RPY_3YR_RT_SUPP,
                  CDR3)


```

After loading the dataset, we converted variables to the correct data types. 

```{r, message=FALSE,warning=FALSE}

#get rid of factor variables: INSTNM, STABBR, PREDDEG, CONTROL and change the data types to numeric 
variable[,-c(2,3,4,8)] %>%
    apply(2, as.numeric) %>%
    as.data.frame() %>%
    {.} -> variable_num

#change the categorical level of the categorical variables:PREDDEG, CONTROL
PREDDEG_factor=factor(variable$PREDDEG,levels=c(0,1,2,3,4),labels = c("NotClassified","Certificate-degree","Associate's-degree","Bachelor's-degree","Graduate-degree"))

Control_factor=factor(variable$CONTROL,levels = c(1,2,3),labels = c("Public","Private Nonprofit","Private For-profit"))

#combine the three datafram to generate a new dataset. 
data_new <- cbind(variable_num, PREDDEG_factor, Control_factor,variable$INSTNM, variable$STABBR)

#rename the categorical varaibles to approriate readable names
colnames(data_new)[35] = 'PREDDEG_factor'
colnames(data_new)[36] = 'Control_factor'
colnames(data_new)[37] = 'INSTNM_factor'
colnames(data_new)[38] = 'STABBR_factor'


```

Considering the variable NPT4_PUB and NPT4_PRIV are mutually exclusive, which both represent average net price, we integrated the information of the two coloumns into a single column, named as NPT4_COMBINE. The new column records the average net price for both private and public TITLE IV institutions.
```{r, message=FALSE,warning=FALSE}

for (i in 1:length(data_new$NPT4_PRIV)) {
   if (is.na(data_new$NPT4_PRIV[i])) {
       data_new$NPT4_PRIV[i] = data_new$NPT4_PUB[i]
   }
}

data_new = data_new[,-10] 
colnames(data_new)[10] <- "NPT4_COMBINE"

```

In order to choose the variables that have enough valid observations related to the topic, we only considered variables with the percent missing value less than 25%. The new data was named as data_clean. 
```{r, message=FALSE,warning=FALSE}

data_clean = data_new[,colMeans(is.na(data_new)) < 0.25]

#rearrange the coloumn names
data_clean = data_clean[c(1,17,18,15,16,2:14)]

write.csv(data_clean,"data_clean.csv")
```

For numerical variables, we calculated the basic summary statistics such as median, min, max, standard deviation and mean. We also used visualizations such as historgams and boxplots to understand the distribution of the values. For categorical variables, we used frequency table to understand the frequencies of each category. 

The table below listed the variables that will be used for the further analysis: 13 of them are continuous variables while 5 of them are categorical variables or Unique ID. After initial data cleaning process, the new data set now contains 18 variables and 7793 observations. 


| Variable Name    | Data Type |  Unit  |  Description                                                          |    Category in Documentation       |
| --------------   | ----------|--------|-----------------------------------------------------------------------| --------------------------------|
| NPT4_COMBINE    | Numeric   | $         |average net price for TITLE IV institutions of both public and private.|  Cost                       |
| DEP_STAT_PCT_IND | Numeric  | %         |Percentage of students who are financially independent                |     Cost                        |
| PAR_ED_PCT_1STGEN| Numeric  | %         |Percentage first-generation students                                  |      Sudent Body                |
| MD_FAMINC        | Numeric  | $         |Median family income in real 2015 dollars                             |       Earning                   |
| PCTPELL          | Numeric  | %         |Percentage of undergraduates who receive a Pell Grant                 |        Financial Aid            |
| PCTFLOAN         | Numeric  | %         |Percent of all federal undergraduate students receiving a federal student loan      |  Financial Aid    |
| GRAD_DEBT_MDN    | Numeric  | $         |The median debt for students who have completed                       |   Financial Aid                 |
| WDRAW_DEBT_MDN   | Numeric  | $         |The median debt for sutdents who have not completed                   |Financial Aid |
| MD_EARN_WNE_P6   | Numeric  | $         |Median income six years after entry                                   |     earning   |
| MD_EARN_WNE_P10  | Numeric  | $         |Median income ten years after entry                                   |     earning  |
| RPY_3YR_RT_SUPP  | Numeric  | %         |Repayment rate 3 years after entering repayment                       |Repayment   |
| CDR3             | Numeric  | %         |Loan default rate 3 years afer entering repayment                     |Repayment        |
| PREDDEG_factor    | Factor  | N/A          |Predominant degree offered                                            |School       |
| Control_factor    | Factor  | N/A          |Control of institution                                                |School     |
| STABBR_factor  | Factor     | N/A       |State                                                                 |School     |
| APPL_SCH_PCT_GE2 | Numeric  | %         |Percentage of students submitting 2 or more than 2 applications       | Student        |
| UNITID | Numeric | N/A      | Unique ID for the institutions | Root  |
| INSTNM | Factor |  N/A      | name for the institutions       | Institution |


we summarized the data set using functions provided in dplyr and ggplot in the variables summary section.


#4. Objective<a id="objective"></a>
Over the year, many students see college as an investment to help them earn more and live better lives after graduation. A large number of research has been conducted to analyze the influence of college quality on students' post-graudation earnings based on colleges' characteristics, students' demographic information, family charateristics as well as federal finanical support to low-income students.  It has become more and more important to understand the factors that contribute to post-graduation earnings and the ability to repay student loans.

Our objective at this stage is to conduct an exploratory data analysis on the CollegeScore dataset, investigating the individual variables' summary statistics and the relationship between these variabls, so as to better prepare for further analaysis on the factors affecting students' post college earnings with some advanced data mining techniques. The summary statistics, dplyr function, ggplot functions as well as some visualization techniques were mainly used in this project. 


#5. Summary of variables<a id="5"></a>
##5.1 Individual variable summary<a id="5.1"></a> 
###5.1.1 School<a id="5.1.1"></a> 
####5.1.1.1. State<a id="5.1.1.1"></a> 

The State variable has 59 levels, which include 55 states in the United States and 4 districts outside mainland US. To better understand how many universities each state has, we created a frequency table as shown below, and also a bar chart to visuzalize the top 15 states having the most universities. Some basic summary statistics are also displayed.

```{r, message=FALSE}

state_freq = count(data_clean,"STABBR_factor")[order(-count(data_clean,'STABBR_factor')$freq),]
state_freq
summary(state_freq)
state_freq[1:15,] %>% ggplot(aes(x=STABBR_factor, y=freq)) +
  geom_bar(stat = 'identity') +
  xlab('State') +
  ylab('Number of Institution') +
  ggtitle('Number of Institution in Each State') +
  theme(plot.title = element_text(family = "Trebuchet MS", color="#666666", face="bold", size=20, hjust=0.5)) 

```

The frequency table counts the number of records belonging to each state, since each record represents a institution, each cell also equals to the number of university in that state.

From the frequncy table, we see that California has the most institutions across the nation, followed by Texas and Ner York. It has about 800 universities! A bar chart is plotted below to show the top 15 states in the frequency table. Then the summary of frequency table also shows that the state having the least university only has one, and 50% of states have more than 132 universities in the state.


####5.1.1.2. Predominant Degree<a id="5.1.1.2"></a> 
Then we analyze the type of degree universities mainly offer. There are four types of degree taken into account: certificate degree, associate degree, bachelor degree, and graduate degree. A frequency table in a format of percentage and a histogram are used to help understand the distribution of the predominant degree.


```{r, message=FALSE}
prop.table(table(data_clean$`PREDDEG_factor`)) * 100
data_clean %>% ggplot(aes(x=PREDDEG_factor, fill = 'blue')) + 
  geom_histogram(stat = "count") +
  xlab("Degree")  +
  ylab('Count') +
  ggtitle('Number of Institution in Each Predominant Degree type') +
  theme(plot.title = element_text(family = "Trebuchet MS", color="#666666", face="bold", size=20, hjust=0.5)) 
```

From above frequency table, we see that about 5% of the population are unclassified in terms of the predominant degree they offer.  43.2% offer certificate degree as their predominant degree, 27.3% predominantly offer Bachelor degree and only 4.23% offer graduate degree as their predominant degree.



####5.1.1.3. Control of Institutions <a id="5.1.1.3"></a> 
In addition to state and predominant degree, control of institution is another categorical variable in the dataset. The label of Control is to indicate whether or not an institution is privately owned and whether or not it is a for-profit organization. There are three levels of this variable: Public, Private Nonprofit, and Private-profit. Public school is assumed to be non-profit so it is not further divided into two subgroups. Below we show the percentage summary of each category and a bar chart is plotted to facilitate understanding.


```{r, message=FALSE}
prop.table(table(data_clean$`Control_factor`)) * 100
data_clean %>% ggplot(aes(x=Control_factor, fill = 'blue')) + 
  geom_histogram(stat = "count") +
  xlab("Type") +
  ylab('Count') +
  ggtitle('Number of Institution in Each School type') +
  theme(plot.title = element_text(family = "Trebuchet MS", color="#666666", face="bold", size=20, hjust=0.5)) 
```

About 50% of all institutions are private for-profit university, which is the most dominant type. Public and private nonprofit are pretty tied in terms of the number of observation in each category.


###5.1.2 Student Body<a id="5.1.2"></a> 
####5.1.2.1 Percentage of First-generation Students<a id="5.1.2.1"></a>
This element identifies the share of federally aided students at the institution who report that they are the first generaion on the FAFSA (Free Application for Federal Student Aid). First generation students are defined as students whose parents didn't attend a college.

With the following codes, we extracted the institutions with the highest and lowest percentage of first-generation students. Then we observed this varible's basic summary statistics: min, max, mean, median and standard deviation.
```{R, message=FALSE, warinig = FALSE}

#the institions with the highest and lowest percentage of first-generation students
data_clean %>%
 slice(c(which.min(PAR_ED_PCT_1STGEN),which.max(PAR_ED_PCT_1STGEN))) %>%
  select (c(1,2,3,8))


summarize(data_clean,
          minPAR_ED_PCT_1STGEN=min(PAR_ED_PCT_1STGEN*100 ,na.rm=TRUE),
          maxPAR_ED_PCT_1STGEN=max(PAR_ED_PCT_1STGEN*100,na.rm=TRUE),
          meanPAR_ED_PCT_1STGEN=mean(PAR_ED_PCT_1STGEN*100,na.rm=TRUE),
          medianPAR_ED_PCT_1STGEN=median(PAR_ED_PCT_1STGEN*100,na.rm=TRUE),
          sdPAR_ED_PCT_1STGEN = sd(PAR_ED_PCT_1STGEN*100,na.rm=TRUE))



```
From the output, we can tell that the highest value existed in  La Belle Beauty Academy with the value of 95.25%. The lowest value is 6.87%, which existed in Wheaton College. From the mean value of 48.08%, we can tell that for federally aided students in most colleges, around half (50.8%) of the students' parents did not complete the college. The standard deviation value of 12.2% indicated a relatively high difference of this element among different colleges.  

Below is the code to generate a visual representation in the histogram. 
```{R}

 
  ggplot(data=data_clean , aes(PAR_ED_PCT_1STGEN)) + 
    geom_histogram(breaks=seq(0.1, 1, by =0.1), 
                   col="white", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for Percentage First-Generation Students") +
    labs(x="PAR_ED_PCT_1STGEN", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```

From the histogram, we can tell the share of the first-generarion students is most frequently falling into the range between 0.5 and 0.6. The values with the value more than 0.8 are rare. 




####5.1.2.2 Number of applications<a id="5.1.2.2"></a>

The variable APPL_SCH_PCT_GE2 is to describe the percentage of students who list two and more than two institutions when he applied for financial aid when submitting application for university. This information is only available to the students who submitted their applications for federal aid and does not cover the whole student body. Nevertheless, this variable still can provide some useful insights about how many universities a student usually apply for. 


```{r, message=FALSE}
college_app_2_clean = data_clean$APPL_SCH_PCT_GE2[!is.na(data_clean$APPL_SCH_PCT_GE2)]*100
summary(college_app_2_clean)

college_app_2_clean %>% as.data.frame() %>%
    mutate(college_app_1 = 100-college_app_2_clean)%>%
    {.}  -> college_app
colnames(college_app)[1] <- "two_or_greater"

college_app %>% gather(key = num_app, value = perc_student) %>%
{.} -> college_app

college_app$num_app = as.factor(college_app$num_app)
levels(college_app$num_app)[levels(college_app$num_app)=="college_app_1"] <- "one"

college_app %>%
    ggplot(aes(factor(num_app), perc_student)) +
    geom_boxplot() +
    xlab("Number of application submitted") +
    ylab("Percentage of Student") +
    labs(title="Percentage of Students Submitting One/Two or Greater Applications") +
    theme(plot.title = element_text(hjust = 0.5))
    
```

The summary statistics show that the median percentage of those students submitting two or more than two application is 41.67% across all universities. The institution having the least percentage only has 4% of students applying for more than one university, while the school with the highest percent has as high as 90% of students applying for more than one university. The boxplot compares the percent of students applying for only one university with the percent of students applying for more than one. We can clearly see that a larger portion of students only listed one institution when submitting their application for financial aid.



###5.1.3 Cost<a id="5.1.3"></a>
####5.1.3.1 Average Net Price for Title IV Institutions(both public and private institutions)<a id="5.1.3.1"></a>

With the following codes, we extracted the IV institutions' basic demographic information with the highest and lowest average net price. Then we observed this varibles's basic summary statistics: min, max, mean, median and standard deviation.
 
```{R, message=FALSE, warinig = FALSE}

data_clean %>%
 slice(c(which.min(NPT4_COMBINE),which.max(NPT4_COMBINE))) %>%
  select (c(1,2,3,6))

summarize(data_clean,
          minNPT4_COMBINE=min(NPT4_COMBINE ,na.rm=TRUE),
          maxNPT4_COMBINE=max(NPT4_COMBINE,na.rm=TRUE),
          meanNPT4_COMBINE=mean(NPT4_COMBINE,na.rm=TRUE),
          medianNPT4_COMBINE=median(NPT4_COMBINE,na.rm=TRUE),
          sdNPT4_COMBINE = sd(NPT4_COMBINE,na.rm=TRUE))



```

From the summary results, we learned that the maximum value of the variable is $87,414, which is for Aerosim Flight Academy located in FL. while the minimum value is about $-19,360 - the value for Berea College located in KY. Considering the elements are collected from Title IV institutions, we reasoned that the negative values may be due to the fact that some institution's financial supoort can cover the students' all the costs, even overbalancing the cost amount. There are not much differerences between the mean value and the median value, which is around $15,000. We can conclude that the average net price costs for most institutions are falling into  this range. The standard deviation value is $7604.884 which is relatively large, indicating a great spread in the data. 


Below is the histogram for this variable which is able to provide us with a visual distribution presentation. 
```{R}

  #histogram for NPT_COM
  ggplot(data=data_clean , aes(NPT4_COMBINE)) + 
    geom_histogram(breaks=seq(0, 90000, by =2000), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for Percentage first-generation students") +
    labs(x="NPT_COM", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```

From the histogram, we notice that the average net cost for IV institutions typically is $16000-$18000. The values between $16000 -$20000 are quite frequent. There were an unsually lagrge number of costs. The institutions with cost of more than $50000 were atypical. Due to the atypical large value, the histogram is abviously right skewed. Without those extreme values, the histogram would be reasonably symmetric. 



####5.1.3.2 Percentage of students who are financially independent<a id="5.1.3.2"></a>

With the following codes, we extracted the institutions which have the highest and lowest percentage of students who are financially independent. Then we observed this variable's basic summary statistics: min, max, mean, median and standard deviation.
```{R}

data_clean %>%
 slice(c(which.min(DEP_STAT_PCT_IND),which.max(DEP_STAT_PCT_IND))) %>%
  select (c(1,2,3,7))

summarize(data_clean,
          minDEP_STAT_PCT_IND=min(DEP_STAT_PCT_IND*100 ,na.rm=TRUE),
          maxDEP_STAT_PCT_IND=max(DEP_STAT_PCT_IND*100,na.rm=TRUE),
          meanDEP_STAT_PCT_IND=mean(DEP_STAT_PCT_IND*100,na.rm=TRUE),
          medianDEP_STAT_PCT_IND=median(DEP_STAT_PCT_IND*100,na.rm=TRUE),
          sdDEP_STAT_PCT_IND = sd(DEP_STAT_PCT_IND*100,na.rm=TRUE))



```

From the summary results, we learned that the maximum value of the variable is 98.56% (Capella University) while the minimum value is about 0.73% (University of Notre Dame). From the mean value, we can tell that in most colleges, around 56% of the students are financially independent. The standard deviation value 23.3% indicates a relatively high difference among different colleges, which can also be concluded from the difference between the maximum value and the minimum value. Below is the code to generate a visual representation in the histogram

```{R}

  #histogram for NPT_COM
  ggplot(data=data_clean , aes(DEP_STAT_PCT_IND)) + 
    geom_histogram(breaks=seq(0.1, 1, by =0.1), 
                   col="white", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for Percentage of Students Who Are Financially Independent") +
    labs(x="DEP_STAT_PCT_IND", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```

From the histogram, we notice that the values between 0.7 to 0.8 are quite frequent. There is no obvious extreme value in the sample, thus the histogram is normally distributed. 



###5.1.4 Financial Aid<a id="5.1.4"></a>  
####5.1.4.1 Percentage of undergraduates who receive a Pell Grant<a id="5.1.4.1"></a>

This element, pulled from the IPEDS student Financial Aid Component, shows the share of undergraduate students who received Pell Grants in a given year, which is an important measure of the financial aid an institution provides to low-income students. We are using the code below to summarize this variable(min, max, mean, median and standard deviation) and extract the institutions with the highest and lowest value. 

```{R, message=FALSE, warinig = FALSE}

data_clean %>%
 slice(c(which.min(PCTPELL),which.max(PCTPELL))) %>%
  select (c(1,2,3,10))

summarize(data_clean,
          minPCTPELL=min(PCTPELL*100 ,na.rm=TRUE),
          maxPCTPELL=max(PCTPELL*100,na.rm=TRUE),
          meanPCTPELL=mean(PCTPELL*100,na.rm=TRUE),
          medianPCTPELL=median(PCTPELL*100,na.rm=TRUE),
          sdPCTPELL = sd(PCTPELL*100,na.rm=TRUE))



```

From the output, we can tell that the range is between 0 to 100%.	No students in Thunderbird School of Global Management has received the Pell grant while all of the students in American Conservatory Theater received the Pell Grant. Among the colleges in the sample, half of the colleges have the rate as high as 52.7% (median value of 52.7%), which means more than half of undergraduare students are able to receive the Pell Grant to cover their costs. The standard deviation value is 22.57%,  indicating a relatively high difference of this element among different colleges, which can also be noticed from the largest range (100%). Below is the code to generate a visual representation in the histogram. 
   
```{R}

 
  ggplot(data=data_clean , aes(PCTPELL)) + 
    geom_histogram(breaks=seq(0, 1, by =0.1), 
                   col="white", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for Percentage of Undergraduates Who Receive a Pell Grant") +
    labs(x="PCTPELL", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```

From the histogram, we are able to conclude that in most colleges, 40% to 50% of the undergraduate students are able to receive the Pell Grant. With little skewness, the histogram is reasonably symmetric. 



####5.1.4.2 Percent of All Federal Undergraduate Students Receiving a Federal Student Loan<a id="5.1.4.2"></a>

This element, as reported in the IPEDs Student Finaicial Aid component, shows the share of undergraduate students who received federal loans in a given year. It can provide important context to figures related to debt, repayment and non-repayment. We were using the code below to summarize this variable(min, max, mean, median and standard deviation) and extracted the institutions with highest and lowest value. 

```{R, message=FALSE, warinig = FALSE}

data_clean %>%
 slice(c(which.min(PCTFLOAN),which.max(PCTFLOAN))) %>%
  select (c(1,2,3,11))

summarize(data_clean,
          minPCTFLOAN=min(PCTFLOAN*100 ,na.rm=TRUE),
          maxPCTFLOAN=max(PCTFLOAN*100,na.rm=TRUE),
          meanPCTFLOAN=mean(PCTFLOAN*100,na.rm=TRUE),
          medianPCTFLOAN=median(PCTFLOAN*100,na.rm=TRUE),
          sdPCTFLOAN = sd(PCTFLOAN*100,na.rm=TRUE))



```

From the output, we can tell that the range is between 0 to 100%.	As we can recall from the previous variable (PCTPELL), Gadsden State Community College has no students receiving federal loans in the given year. Among the colleges in the sample, half of colleges have this rate as high as 60.08% , which means around 60% of undergraduate students received the fedaral student loans in the given year. The standard deviation value is 29.26%,  indicating a relatively high difference of this element among different colleges, which can also be noticed from the largest range (100%). Below is the code to generate a visual representation in the histogram. 


```{R}

 
  ggplot(data=data_clean , aes(PCTFLOAN)) + 
    geom_histogram(breaks=seq(0, 1, by =0.1), 
                   col="white", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for Percent of all Federal Undergraduate Students Receiving a Federal Student Loan") +
    labs(x="PCTFLOAN", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```

From the histogram, it's obvious that there are two peaks in the graph. The rate between 0-10% and the rates between 60% to 80% have similar frequency compared to the other ranges. 
 



####5.1.4.3 The median debt for students who have completed<a id="5.1.4.3"></a>

This variable recorded debt for students who have completed the education. We were using the code below to summarize this variable(min, max, mean, median and standard deviation) and extracted the institutions with largest and smallest value. 

```{R, message=FALSE, warinig = FALSE}

data_clean %>%
 slice(c(which.min(GRAD_DEBT_MDN),which.max(GRAD_DEBT_MDN))) %>%
  select (c(1,2,3,12))

summarize(data_clean,
          minGRAD_DEBT_MDN=min(GRAD_DEBT_MDN ,na.rm=TRUE),
          maxGRAD_DEBT_MDN=max(GRAD_DEBT_MDN,na.rm=TRUE),
          meanGRAD_DEBT_MDN=mean(GRAD_DEBT_MDN,na.rm=TRUE),
          medianGRAD_DEBT_MDN=median(GRAD_DEBT_MDN,na.rm=TRUE),
          sdGRAD_DEBT_MDN = sd(GRAD_DEBT_MDN,na.rm=TRUE))


```

From the output, we can tell that the highest value is $48,250, belonging to Southwest University of Visual Arts-Tucson, while the lowest value is 1448, belonging to South Florida Institute of Technology. From the median value of 14000, we can tell that among the colleges in the sample, for students who have completed the education, half of them have  median loan debt of $14000. The standard deviation value is $8020.958,  indicating a relatively high difference of this element among different colleges. Below is the code to generate a visual representation in the histogram. 

```{r}

 ggplot(data=data_clean , aes(GRAD_DEBT_MDN)) + 
    geom_histogram(breaks=seq(0, 50000, by =2000), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for The median debt for students who have completed") +
    labs(x="GRAD_DEBT_MDN", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))


```

From the histogram, it is obvious that most students in the sample colleges still have $8000 - $10000 debt amount after they completed the education. This amount is related to the federal loan amount provided by each institution. Additionally, it is associated with students' ability to repay the loan during the academic period. For example, for the students who were capable of working through the acedemic years or securing jobs before graduation may have a less value for this variable. 



####5.1.4.4 The median debt for students who have not completed<a id="5.1.4.4"></a>

WDRAW_DEBT_MDN describes the median amount of debt for students who have not completed their study. In other words, they are still attending the university.

```{r, message=FALSE}
median_debt_non_null = data_clean$WDRAW_DEBT_MDN[!is.na(data_clean$WDRAW_DEBT_MDN)]
summary(median_debt_non_null)
sd(median_debt_non_null)

#plot a ggplot to better illustrate
data_clean %>% ggplot(aes(x = WDRAW_DEBT_MDN)) +
                geom_histogram(binwidth = 450) 

ggplot(data=data_clean,
       aes(x=WDRAW_DEBT_MDN,
           fill = I('red'))) +
    geom_density(alpha=0.5) +
    scale_x_continuous("Median Debt for Students Who Have Completed")

```

We use summary statistics, standard deviation and histogram to understand the distribution of this variable. The summary statistics show that students in more than 50% of institutions have a median debt of more than $5500, which is not very unaffordable. The median debt for attending students could be as much as $27620 for some schools and as low as $600 for others, indicating that it may have a large variance. So we also calculate standard deviation to measure the dispersion of the distribution. The standard deviation is $2415.623, which means about 95% of institution have  median debt ranging from $1167.754  to $10830.246. The histogram shows that the distribution of the median roughly follows a standard distribution with a sharp peak and slightly heavy tail.



###5.1.5 Earning<a id="5.1.5"></a> 
####5.1.5.1 Median family income in real 2015 dollars<a id="5.1.5.1"></a>
This element is recorded the median family income of students, one of the undergraduate student demographics for earnings cohorts. We are using the code below to summarize this variable(min, max, mean, median and standard deviation). 

```{R, message=FALSE, warinig = FALSE}

data_clean %>%
 slice(c(which.min(MD_FAMINC),which.max(MD_FAMINC))) %>%
  select (c(1,2,3,9))

summarize(data_clean,
          minMD_FAMINC=min(MD_FAMINC ,na.rm=TRUE),
          maxMD_FAMINC=max(MD_FAMINC,na.rm=TRUE),
          meanMD_FAMINC=mean(MD_FAMINC,na.rm=TRUE),
          medianMD_FAMINC=median(MD_FAMINC,na.rm=TRUE),
          sdMD_FAMINC = sd(MD_FAMINC,na.rm=TRUE))



```

From the output, we can tell that the highest value is $155,606.6 for Jewish Theological Seminary of America, while the lowest value is $0 for Associated Technical College-Los Angeles. From the median value of $19,262.26, we can tell that among the colleges in the sample, the students in half of them had the family income below $19,262.26. The standard deviation value is $18,824.31, indicating a relatively high difference of this element among different colleges. Below is the code to generate a visual representation in the histogram 

```{R}

 
  ggplot(data=data_clean , aes(MD_FAMINC)) + 
    geom_histogram(breaks=seq(0, 156000, by =3000), 
                   col="red", 
                   aes(fill=..count..),na.rm=TRUE)+
    labs(title="Histogram for Median family income in real 2015 dollars") +
    labs(x="MD_FAMINC", y="Count") +
    theme(plot.title = element_text(hjust = 0.5))
```

From the histogram, we are able to conclude that in most colleges, students' family income fall into the range of $12,000 - $18,000. Due to some atypical large values, the histogram is obviously skewed to right. The values larger than $18,000 are tending to be extreme and the cases larger than $75000 are rare, which means that rare colleges have the students with family income more than $75000.


####5.1.5.2 Earning after graduation<a id="5.1.5.2"></a>

MD_EARN_WNE_P6 and MD_EARN_WNE_P10 are two of the earning varibles we selected to study students' post-graduation earnings. MD_EARN_WNE_P6 is the median earning for students after six years of their entry, which corresponds to two years after graduation for a four-year program. Likewise, MD_EARN_WNE_P10 is the median earning ten years after their entry, which usually corresponds to four years after graduation. These two metrics give us an idea of how much money students are making after their graduation, in both short and medium terms.

In addition to these two variables, a derived variable is also calculated as the difference between  MD_EARN_WNE_P6 and MD_EARN_WNE_P10. 

```{r,message=FALSE}
earning = select(data_clean, MD_EARN_WNE_P6, MD_EARN_WNE_P10 )
earning_clean = na.omit(earning)
earning_clean %>%
    mutate(salary_increase = MD_EARN_WNE_P10-MD_EARN_WNE_P6) %>%
    {.} -> earning_clean
summary(earning_clean)
apply(earning_clean, 2, sd) #dispersion increases

earning_clean %>% gather(key = years_from_entry, value = salary) %>%
    {.} -> earning_clean1

earning_clean1[earning_clean1$years_from_entry != 'salary_increase',] %>% 
    ggplot(aes(x = salary, fill =years_from_entry )) +
    geom_density(alpha = 0.5) + 
    xlim(0, 150000) +
    xlab("Median Earning") +
    scale_fill_discrete(name="Years from Entry",
                         breaks=c("MD_EARN_WNE_P10", "MD_EARN_WNE_P6"),
                         labels=c("10 years", "6 years"))


```
    
The six-year after-entry median earnings of 50% institutions is below the $25,300, while ten-year-after-entry median earning is higher by about $5,500. The histogram gives us a more clear idea of the earning distribution. Most institutions with students having a median earnings between $10,000 to $50,000 six years after entry. The distribution of ten-year-after-entry falls at the right side of the six-year distribution, which means that the earning increases as students' experience increases. Besides, the ten-year post-graduation earning has a wider spread than that of the six-years. This indicates that there is a greater gap of the earning amount among the different institutions, which can be confirmed by an increase in the standard deviation.


###5.1.6 Repayment 

####5.1.6.1 3-year Repayment rate<a id="5.1.6.1"></a>
The variable RPY_3YR_RT_SUPP measures the percentage of students who entered repayment from October 1, 2010 to September 30, 2011 and made progress in the following three years. Repayment rates are generally considered more sensitive than default rates(we will study later), which measures only the worst-case scenario for repayment outcomes. 

```{r,message=FALSE}
repayment_clean = na.omit(data_clean$RPY_3YR_RT_SUPP)
summary(repayment_clean)
qplot(repayment_clean, geom = "histogram") +
xlab("Repayment Rate") +
ylab("Count") +
labs(title="Histogram for Repayment Rate") +
theme(plot.title = element_text(hjust = 0.5))

```

From the summary statistics, we see that 50% institutions have more than 40% of students who were making progress in their repayment. A histogram is also plotted to show the distribution, clearly with a heavy tail. 


####5.1.6.2 3-year Default rate<a id="5.1.6.2"></a>

The three-year cohort default rate describes the repayment in the opposite of repayment rate. In this dataset, it was calculated using the cohort of borrowers who entered repayment on their federal student loans between Octorber 1, 2010 to September 30, 2011, and defaulted before September 2012. 


```{r,message=FALSE}
default_clean = na.omit(data_clean$CDR3)
summary(default_clean)
qplot(default_clean, geom = "histogram") +
xlab("Default Rate") +
ylab("Count") +
labs(title="Histogram for Default Rate") +
theme(plot.title = element_text(hjust = 0.5))

summary(data_clean$RPY_3YR_RT_SUPP + data_clean$CDR3)
```

The median default rate across all universities is 13%, which means that more than 50% of the universities have more than 13 out of 100 students defaulted their loan! 


#6. Relationship between variables<a id="6"></a>
##6.1. The Relationship between Average Net Cost for Title IV institutions and State<a id="6.1"></a>

To analyze the relationship between the average net cost for Title IV institutions and State, we grouped the data into state level to take a further analysis on each state's min, max and median value of the Average Net Cost - We would like to investigate the distribution of institutions ' average net price in each state.

```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(STABBR_factor) %>%
    dplyr::summarise(minNPT4_COMBINE=min(NPT4_COMBINE ,na.rm=TRUE),    
    maxNPT4_COMBINE=max(NPT4_COMBINE,na.rm=TRUE),medianNPT4_COMBINE=median(NPT4_COMBINE,na.rm=TRUE))  %>%
       arrange(desc(medianNPT4_COMBINE))   %>%
{.}  ->NPT4_STATE

NPT4_STATE

```

Based on the output, we can see that the highest median value for the avreage net price exists in DC while the lowest median value is in AS(American Samoa). Moreover, we found that the top 5 states are DC, VT, MA, NH, RI, which are the states with certain well-known educational institutions. 


##6.2. The relationship between median debt and average net price for Title IV institutions<a id="6.2"></a>

We hypothesised that the students who completed education in colleges with high costs will have a higher value of median debt. We use the following code to generate the scatterplot between these two variables to verify our hypothesis. 

```{R}


ggplot(data_clean, aes(x =NPT4_COMBINE, y = GRAD_DEBT_MDN)) + geom_point(color="red")+  geom_smooth(method = "lm", se = TRUE)+
  labs(title="Scatterplot between median debt and average net price for Title IV institutions ") +
    theme(plot.title = element_text(hjust = 0.5))
      

  
```
  
From the scatter plot, it is obvious that the NPT4_COMBINE is in a positive linear relationship with GRAD_DEBT_MDN: the data shows an uphill pattern from left to right; As the average net price for Title IV institutions increases, the value of median debt for students who have completed the college increases as well. 

##6.3. The relationship between Percentage of Pell Grant and college type(CONTROL)<a id="6.3"></a>

To compare the percentage of Pell Grant in different control types, we grouped the Percentage of Pell Grant data using college type to take a further analysis on each college type's min, max and median value of Percentage of Pell Grant. 

```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(Control_factor ) %>%
    dplyr::summarise(minPCTPELL=min(PCTPELL ,na.rm=TRUE),    
    maxPCTPELL=max(PCTPELL,na.rm=TRUE),medianPCTPELL=median(PCTPELL,na.rm=TRUE))  %>%
       arrange(medianPCTPELL)   %>%
{.}  ->PCTPELL_CONTROL
PCTPELL_CONTROL

```

From the result, the private nonprofit institutions and the public institutions both have a low median values while the private for-profit institutions have a higher value. This is reasonable because the private for-profit colleges may have much higher costs than the private nonprofit and public institutions. The low-income students were more likely to seek a Pell Grant as assistance. Additionally, in some states, state financial aid may be sufficient to cover costs at community colleges; thus the students in those schools may not need to seek for additional financial aid like Pell Grant.

Below is the stacked histogram between these two variables. 
```{r}

ggplot(data_clean, aes(x=PCTPELL, fill=Control_factor)) + geom_histogram(alpha=0.9, position="identity") +
  labs(title="Stacked Histogram between PCTPELL and Control ") +
    theme(plot.title = element_text(hjust = 0.5))


```

From the overlaying histograms, the percentages of students who received the Pell Grant for private for-profit institutions are quite frequent between 0.7 and 0.75 ; the percentages of students who receive the Pell Grant for public institutions and private nonprofit institutions are quite frequent around 0.4. The histogram for private for-profit is slightly left skewed due to small values near 0. The histogram for public and private non-profit institutions are reasonably symmetric.


##6.4. The relationship between Percentage first-generation students and States<a id="6.4"></a>

To compare the percentage of first-generation students in each states, we grouped data into the state level to take a further analysis on the min, max and median value of Percentage first-generation students on the state base. The top 5 states as well as the lowest 5 states are extracted. 

```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(STABBR_factor ) %>%
    dplyr::summarise(minPAR_ED_PCT_1STGEN=min(PAR_ED_PCT_1STGEN ,na.rm=TRUE),    
    maxPAR_ED_PCT_1STGEN=max(PAR_ED_PCT_1STGEN,na.rm=TRUE),medianPAR_ED_PCT_1STGEN=median(PAR_ED_PCT_1STGEN,na.rm=TRUE))  %>%
       arrange(medianPAR_ED_PCT_1STGEN)   %>%
{.}  ->PAR_ED_PCT_1STGEN_STATE

PAR_ED_PCT_1STGEN_STATE

```

The results show that the universities located in ND, SD, VT, MN and MT have the lowest percentage first-generation students, which indicates that the students in these five states would have a better family education background. The five states with the highest share of first-generation students are LA, NJ, MP, MV, and MH. 


##6.5. The relationship between Family Income and Percentage of Pell Grant<a id="6.5"></a>

We hypothesed that colleges with small value of family income would tend to have high percentages of Pell Grant. The following codes are used to generate the scatter plots between these two variables. 

```{r}

ggplot(data_clean, aes(x =MD_FAMINC, y = PCTPELL)) + geom_point(color="red")+  geom_smooth(method = "lm", se = TRUE)+
  labs(title="Scatterplot between MD_FAMINC and PCTPELL ") +
    theme(plot.title = element_text(hjust = 0.5))
      
```

From the scatter plot, it is obvious that the MD_FAMINC is in a negative linear relationship with PCTPELL: the data shows a downhill pattern from left to right; As the MD_FAMINC increases, the value of PCTPELL decreases. It makes sense in the real world; for institutions with low percentage of students who receive the Pell Grant, the financial aid like Pell Grant may not be as necessary as they are in the institutions with high value of PCTPELL, since these collges students tend to have a higher median family income. 



##6.6. The Relationship between the Percentage of Financially-independent Students and Control<a id="6.6"></a>

To compare the percentage of financially-independent students in the institutions with different college type, we grouped the data by the control type(private for-profit, public, private nonprofit) to take a further analysis on the min, max and median value for each type. 

```{R message=FALSE, warinig = FALSE}

data_clean %>%
  group_by(Control_factor) %>%
    dplyr::summarise(minDEP_STAT_PCT_IND=min(DEP_STAT_PCT_IND ,na.rm=TRUE),    
    maxDEP_STAT_PCT_IND=max(DEP_STAT_PCT_IND,na.rm=TRUE),medianDEP_STAT_PCT_IND=median(DEP_STAT_PCT_IND,na.rm=TRUE))  %>%
       arrange(desc(medianDEP_STAT_PCT_IND))   %>%
{.}  ->DEP_STAT_PCT_IND_CONTROL

DEP_STAT_PCT_IND_CONTROL

```

From the result, we can tell the highest median value is in privately for-profit colleges, which means that in most private for-profit colleges, the students are more likely to be financially independent. 

##6.7. The Relationship between Percentage of Students Who Receive the Federal Loans and Control.<a id="6.7"></a> 

To compare the percentage of students who receive the federal loans in the given year in each schools control type, we grouped the data by the control type(private for-profit, public, private non-profit) to take a further analysis on the min, max and median value of the variable seperately. A stacked histogram is also used to generate a more visual presentation. 

```{R message=FALSE, warinig = FALSE}


data_clean %>%
  group_by(Control_factor ) %>%
    dplyr::summarise(minPCTFLOAN=min(PCTFLOAN ,na.rm=TRUE),    
    maxPCTFLOAN=max(PCTFLOAN,na.rm=TRUE),medianPCTFLOAN=median(PCTFLOAN,na.rm=TRUE))  %>%
       arrange(medianPCTFLOAN)   %>%
{.}  ->PCTFLOAN_CONTROL

PCTFLOAN_CONTROL


#stacked histogram
data_clean %>%
  ggplot(aes(x=PCTFLOAN)) +
  labs(title="Stacked histgram between Control and PCTLOAN ")+
  geom_bar(binwidth=0.1,aes(fill=Control_factor )) + theme(plot.title = element_text(hjust = 0.5))


```

From the result,  private institutions have a much larger median value than the public institutions. With a much higher costs burden, it makes sense that the low-income students in private institutions are much more likely to seek financial aids than the students in public institutions. 

From the stacked histogram, we can tell that for all three college types, the most frequent range appears between 0.6 and 0.8, which is consistent with the findings we observe in the individual variable summary section. 


##6.8 The Relationsip between Median Debts and Post-Graduation Earnings<a id="6.8"></a> 
Next, we analyze the relationship between the amount of the debt and post-graduation earnings. There are two variables in the dataset to summarize the median amount of debt for student body, one for students who already graduated and one for students who have not completed their study. We decided to use debt for students who have not completed their study in this problem, since it makes more sense for the purpose of prediction.


```{r, message=FALSE}


data_clean %>% ggplot(aes(x = WDRAW_DEBT_MDN, y = MD_EARN_WNE_P6)) + 
                geom_jitter() +
                geom_smooth(method = "lm", se = FALSE, col = 'red') +
                xlab("Median Amount Debt for Students who have not completed") +
                ylab("Earning  6 Years from Entry")

data_clean %>% select(WDRAW_DEBT_MDN, MD_EARN_WNE_P6) %>%
      na.omit() %>%
       {.} -> earn_debt

cor(earn_debt$WDRAW_DEBT_MDN,earn_debt$MD_EARN_WNE_P6)


```

First, we used a scatter plot to visualize the relationship between earnings and the amount of debt, the plot clearly shows a positive relationship. Then we further calculated pearson correlation to confirm our hypothesis. The resulting coefficient 0.44 indicates a moderate linear relationship between earnings and debt.

##6.9 The Relationship between the Default Rate of Loan Repayment and Post-graduation Earnings<a id="6.9"></a> 
For one thing, understanding the relationship between the default rate of loan repayment and post-graduation earnings can help federal financial committee to improve their decisions about load granting. If the default rate decreases as the earnings increases, the committee may prefer to grant more financial aid to institutions whose students have higher earnings. For another, the default rate of repayment for a university can also help predict the post-graduation earnings for its students. 


```{r, message=FALSE}
data_clean %>% ggplot(aes(x = CDR3, y = MD_EARN_WNE_P6)) + 
                geom_jitter() +
                geom_smooth(method = "lm", se = FALSE, col = 'red')+
                xlab("Three-year Cohort Default Rate") +
                ylab("Earning  6 Years from Entry")

data_clean %>% select(CDR3, MD_EARN_WNE_P6) %>%
      na.omit() %>%
       {.} -> earn_default

cor(earn_default$CDR3,earn_default$MD_EARN_WNE_P6)

```

A scatter plot is created to visualize the relationship between these two variables. From the chart, we see that earnings seems to show a decreasing trend as the default rate increases, which shows a negative relationship between earnings and default rate. Then we calculate the correlation coefficient between these two variables. The resulting r = -0.33 shows that the correlation between earnings and default rate is negative but the relationship is not very strong, which may be due to the influences of some outliers. To conclude, the negative relationship between earnings and default rate of loan repayment needs extra data to validate.

##6.10 The Relationship between Earning 6 Years from Entry and Degree Type<a id="6.10"></a> 

The higher education one receives, the higher the earning is after graduation. This is a common assumption we are making when investing higher education, and this is it really the case. In this question, we would like to study if it's worthwhile to invest in higher degree. 


```{r, message=FALSE}

data_clean %>%
  ggplot(aes(x=`PREDDEG_factor`,
             y=MD_EARN_WNE_P6)) +
  geom_boxplot(aes(fill = `PREDDEG_factor`)) +
  xlab("Degree Type") +
  ylab("Earning  6 Years from Entry") +
  scale_fill_discrete(name="Degree Type")



```

From the boxplot above, we see that the higher the education, the higher the median earning 6 years after entry. Especially, a graduate-degree gives a hugh rise to one's earning.


##6.11 The Relationship among Predominant Degree, Control and Earning after 6 year of Entry<a id="6.11"></a> 

The following plot shows the relationship among two factor variables (predominant degree award variable and control variable) associated with one numeric variable (MD_EARN_WNE_P6: Median earnings of students working and not enrolled 6 years after entry).

For the R code, we first grouped the dataset by PREDDEG factor and Control factor. Then, we summarized the average earnings. After that, we set the aesthetic mapping between Control_factor and PREDDEG_factor as the horizontal axis and the vertical axis. Then, we use the function geom_tile()[ggplot2 package] to create a heat map to visualize the correlation between variables. The default color scheme maps a very dark blue color for the lowest abundance values, up to a very light blue for the highest abundance values.


```{r}

data_clean %>%
  group_by(PREDDEG_factor, Control_factor) %>%
    dplyr::summarize(avg.earn_p6=mean(MD_EARN_WNE_P6,na.rm=TRUE))%>%
      ggplot(aes(x=Control_factor, y=PREDDEG_factor)) +
         geom_tile(aes(fill=avg.earn_p6)) +
            ggtitle("Heat map between Average Earnings and PREDDEG&Control Factors")


```

Mean value of the earnings is more representative for the two categories, predominant degree and control.  According to the plot, we realized that private for-profit colleges whose predominant degree awarded is graduate degree have the lowest average earning with the minimum average value at $3100, while Public colleges whose predominant degree awarded are graduate degree has the highest average earnings with the maximum average value at $45,850.


##6.12 The Relationship between Predominant Degree and Control<a id="6.12"></a> 

The following plot shows the relationship between two factor variables (predominant degree award variable and control variable). 

For the R code, our team first set the aesthetic mapping on Control_factor as the horizontal axis. Then, we used the function geom_bar() to fill different control types using the counting values of PREDDEG, which created bars based on a grouped frequency distribution. After that, we used the function xtabs() to calculate the exact number for each predominant degree awarded by different types of colleges.


```{R}
data_clean %>%
ggplot(aes(x=Control_factor))+
geom_bar(aes(fill=PREDDEG_factor), position = 'dodge')+
ggtitle("Bar plot between PREDDEG and Control Factor")

```


```{R}
data_clean %>%
xtabs(formula = ~PREDDEG_factor+Control_factor)

```

From the graph we can see that for the public type of school, associate degree is mostly awarded and it is in the middle of the distribution, with fewer NotClassified degree and fewer graduate degree in the extremes. But the distribution is symmetric compared with the other two types. For the Private Nonprofit type of school, mostly awarded degrees (Bachelor degree and Graduate degree) are located at the right of the distribution, with fewer NotClassified degree on the left.  The distribution shows a negative skew: the awarded degrees extend to the left farther than they do to the right. For the private for-profit type of school, mostly awarded degree (Certificate degree) is on the left of the distribution, with fewer graduate degree on the right. The distribution shows a positive skew: the awarded degrees extend to the right farther than they do to the left.

##6.13 The Relationship between Control and Median earnings of Students Working and Not Enrolled 6 Years after Entry<a id="6.13"></a> 

The following plot shows one factor variable (control variable) associated with one numeric variable (MD_EARN_WNE_P6: Median earnings of students working and not enrolled 6 years after entry).

We used the ggplot() function to initialize the ggplot object and declared the input data frame for a graphic with x equals Control_factor and y equals Median Earnings. Then, we used the geom_violin() function which showed a compact display of a continuous distribution. The geom_violin() function is a blend of geom_boxplot() and geom_density(), which shows a mirrored density plot. For better visualization, we used geom_boxplot() to create a box and whiskers plot, which showed five summary statistics (the median, two hinges and two whiskers), and all outlying points individually. And the summary() function further displayed the exact values. The plot superimposed with boxplots showed side-by-side violin plots of median earnings of students working and not enrolled 6 years after entry according to different college types.

```{r}
  data_clean %>%
  ggplot(aes(x=Control_factor, y=MD_EARN_WNE_P6)) +
  geom_violin(aes(fill=Control_factor), scale = 'area')+ 
  geom_boxplot(aes(fill=Control_factor), width = 0.25, outlier.size = 1.25)+
  ggtitle("Violin plot between Control Factor and Median Earnings")

```
```{r}
summary(data_clean$MD_EARN_WNE_P6[data_clean$Control_factor=="Public"])
summary(data_clean$MD_EARN_WNE_P6[data_clean$Control_factor=="Private Nonprofit"])
summary(data_clean$MD_EARN_WNE_P6[data_clean$Control_factor=="Private For-profit"])
```

All the three types of schools have far out values above, which can be explored further. Obvious differences were contained in these three boxplots. The boxplot of public college is comparatively short, while the boxplot of private nonprofit is comparatively tall. The private for-profit college has the lowest median earning.

For Public type of school, the earnings has a high density around the level of $25,000. From the box plot summary, we realize that half of the public school student earnings are between  $21,880 and $30,320. Also, a larger mean value than median value indicates a positive skew distribution.

For the Private Nonprofit type of school, the earnings has a high density around the level of $31,250. From the box plot summary, we realize that half of the private nonprofit school student earnings are between $13,000 and $35,800. Also, a lower mean value than median value indicates a negative skew distribution.

For the Private For-profit type of school, the earnings has a high density around the level of $18,750. The distribution is not symmetric. From the box plot summary, we realize that half of the private for-profit school student earnings are between $12,080 and $24,700. Also, a lower mean value than median value indicates a negative skew distribution.


#7. Findings and Conclusion<a id="7"></a> 

Through the process of summarizing these variables and analyzing the relationship between these variables, we found that for federally-aided students in most colleges, around half of the students' parents did not complete colleges.The average net price costs for most institutions are falling into the range between $16000 - $20000. Among the 7703 institution samples, more than 50% of the students received a Pell Grant or Federal Loan as means of finanical support, and on average, 60% of students are financially independent. In most colleges, the students are able to reach the family income between $12000 and $18000 after they graduate.

We also found that California has the most universities across the nation, with 797 institutions. In terms of predominant degrees offered, 43.2% are classified as a certificate degree predominant institution, which is the most prevalent type. 

Our findings also suggest that the Title IV institutions located in DC, VT, MA, NH, RI have a relatively high amount of average net costs than those in other states. The students in private non-profit institutions and public institutions are less likely to seek a Pell Grant as financial assistance than the students in the private for-profit colleges.In most private for-profit colleges, the students are more likely to be financially independet. 

It indicates that there exists a negative correlation between the percentage of students who receive a Pell Grant and the students' median family income; for institutions with low percentage of students who receive the Pell Grant, the financial aid like the Pell Grant may not be as necessary as they are in the institutions with high value of PCTPELL, thus these college students will tend to have a high median family income after they graduate.

As to the factors that influence post-graduation earnings, we explored the relationship between median earnings six years from entry and other six variables. The analysis suggests that there is a positive relationship between the median debt amount for students who have not completed college and post-graduation earnings. This may be due to the fact that top universities usually have higher tuition but may also indicate that students who are willing to take more debts for their college education are likely to make more money after graduation. In addition, the default rate of student loans is negatively related to post-graduation earnings. This finding is reasonable since students making more money are more likely to pay off their debt. The variable can be used as a school-level predictor to predict overall post-graduation earnings for each university. The degree type, unsurprisingly, has an impact on the earnings students are making after graduation. As the level of education increases, the post-graduate earnings also increase significantly, which suggests that investing in education is worthwhile.

When it comes to relationship between control of institution and earning, private for-profit institutions whose predominant degree awarded is graduate degree has the lowest average earnings with the minimum average value at $3100. Public institutions whose predominant degree awarded is graduate degree has the highest average earning with the maximum average value at $45850. Although the graduate degree awarded by public colleges shows the least frequency, it contains the most value because those students (working and not enrolled 6 years after entry) graduating from public colleges holding the graduate degree show the highest average earnings compared with students holding other degrees awarded by different institutions.Also, students graduate from Private Nonprofit institution generally has a higher earning than those students graduate from other types of institutions.

According to all analysis, we conclude that the attributes such as percentage of students who receive a Pell Grant, median earning six years from entry, amount of debt, default rate for student loans and predominant degree type can be used to predict the students' post-graudation earnings.
    








